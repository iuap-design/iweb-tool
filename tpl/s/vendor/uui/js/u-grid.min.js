!function($,window,document,undefined){var dataSource=function(t,i){this.defaults={},this.gridComp=i,this.options=$.extend({},this.defaults,t),this.rows=new Array,this.hasParentRows=new Array,this.nothasParentRows=new Array,this.sortRows()},gridCompColumn=function(t,i){this.defaults={width:200,sortable:!0,canDrag:!0,fixed:!1,visible:!0,canVisible:!0,sumCol:!1,editable:!0,editFormShow:!0,autoExpand:!1,editType:"text",dataType:"String",format:"yyyy-MM-dd hh:mm:ss",headerLevel:1};var e={sortable:i.sortable,canDrag:i.canDrag,width:i.columnWidth};"Date"==t.dataType&&(this.defaults.format="yyyy-MM-dd"),i.showTree&&(t.sortable=!1),this.options=$.extend({},this.defaults,e,t),this.options.width=parseInt(this.options.width),this.firstColumn=!1},gridComp=function(t,i){this.dataSource=dataSource,this.gridCompColumn=gridCompColumn,this.ele=t[0],this.$ele=t,this.defaults={id:"grid",columnWidth:200,sortable:!0,canDrag:!0,canSwap:!0,showHeader:!0,columnMenu:!0,showNumCol:!1,multiSelect:!1,showSumRow:!1,editable:!1,noneEditableFormShow:!0,editType:"default",showTree:!1,autoExpand:!0,cancelFocus:!1,maxHeaderLevel:1},this.transDefault={ml_show_column:trans("gridComp.show_column","显示/隐藏列"),ml_clear_set:trans("gridComp.clear_set","清除设置"),ml_no_rows:trans("gridComp.no_rows","无数据"),ml_sum:trans("gridComp.sum","合计:"),ml_close:trans("gridComp.close","关闭")},this.transMap=$.extend({},this.transDefault,i.transMap),i.maxHeaderLevel>1&&(i.canSwap=!1),this.options=$.extend({},this.defaults,i),this.options.showTree&&(this.options.showNumCol=!1),this.gridCompColumnArr=new Array,this.gridCompColumnFixedArr=new Array,this.basicGridCompColumnArr=new Array,this.gridCompLevelColumn=new Array,this.treeLeft=10,this.multiSelectWidth=40,this.numWidth=40,this.multiWidth=40,this.headerHeight=34,this.headerHeight=34*parseInt(this.options.maxHeaderLevel),this.countContentHeight=!0,this.minColumnWidth=80,this.columnMenuWidth=160,this.scrollBarHeight=16,this.columnMenuHeight=33,this.initGrid()};gridComp.prototype={initGrid:function(){var t=this;this.initOptions(),this.initVariable(),this.initWidthVariable(),this.initGridCompColumn(),this.initDataSource(),this.createDivs(),this.inte=setInterval(function(){t.setIntervalFun.call(t)},300)},destroySelf:function(){clearInterval(this.inte),this.$ele.data("gridComp",null),this.ele.innerHTML=""},initOptions:function(){this.options.width=this.formatWidth(this.options.width),this.options.height=this.formatWidth(this.options.height),"100%"!=this.options.height&&this.options.height||(this.countContentHeight=!1),this.leftW=0,this.options.showNumCol&&(this.leftW+=this.numWidth),this.options.multiSelect&&(this.leftW+=this.multiWidth),this.exceptContentHeight=0,this.options.showHeader&&(this.exceptContentHeight+=this.headerHeight);var t=window.location.href,i=t.indexOf("?");i>0&&(t=t.substring(0,i)),this.localStorageId=this.options.id+t},initVariable:function(){this.initDataSourceVariable(),this.mouseUpX="mouseUpX",this.mouseUpY="mouseUpY",this.mouseDownX="mouseDownX",this.mouseDownY="mouseDownY",this.mouseMoveX="mouseMoveX",this.mouseMoveY="mouseMoveY",this.scrollLeft=0,this.scrollTop=0,this.showType="",this.createGridFlag=!1,this.createFormFlag=!1,this.columnClickX=0,this.columnClickY=0,this.$sd_storageData=null,this.columnMenuMove=!1,this.createColumnMenuFlage=!1,this.firstColumn=!0,this.lastVisibleColumn=null,this.lastVisibleColumnWidth=0,this.menuColumnsHeight=0},initDataSourceVariable:function(){this.selectRows=new Array,this.selectRowsObj=new Array,this.selectRowsIndex=new Array,this.allRows=new Array,this.eidtRowIndex=-1},initWidthVariable:function(){this.wholeWidth=0,this.wholeHeight=0,this.rowHeight=0,this.fixedRealWidth=0,this.fixedWidth=0,this.contentRealWidth=0,this.contentWidth=0,this.contentMinWidth=0,this.contentHeight=0},initGridCompColumn:function(){var t=this;t.gridCompColumnFixedArr=new Array,this.options.columns&&$.each(this.options.columns,function(i){if(this.headerLevel>1)t.gridCompLevelColumn.push(this);else{var e=new gridCompColumn(this,t.options);t.gridCompColumnArr.push(e);var o=new gridCompColumn(this,t.options);t.basicGridCompColumnArr.push(o)}});var i=this.getGridCompColumnArrFromLocal();null!=i&&(this.gridCompColumnArr=i,$.each(this.gridCompColumnArr,function(){for(var i=this.options.field,e=0;e<t.options.columns.length;e++){var o=t.options.columns[e];if(o.field==i){var n=$.extend({},o,this.options);this.options=n;break}}})),this.menuColumnsHeight=this.gridCompColumnArr.length*this.columnMenuHeight,this.initGridCompFixedColumn(),this.columnsVisibleFun()},setRequired:function(t,i){var e=this;$.each(this.gridCompColumnArr,function(o){this.options.field==t&&(this.options.required=i,i?$("#"+e.options.id+"_edit_"+this.options.field).parent().find(".u-grid-edit-mustFlag").show():$("#"+e.options.id+"_edit_"+this.options.field).parent().find(".u-grid-edit-mustFlag").hide())})},getLevelTitleByField:function(t){for(var i=0;i<this.gridCompLevelColumn.length;i++){var e=this.gridCompLevelColumn[i].field;if(e==t)return this.gridCompLevelColumn[i].title}return""},initGridCompFixedColumn:function(){var t=this;$.each(this.gridCompColumnArr,function(i){1==this.options.fixed&&t.gridCompColumnFixedArr.push(this)}),$.each(this.gridCompColumnFixedArr,function(i){for(var i=t.gridCompColumnArr.length;i>-1;i--)if(t.gridCompColumnArr[i]==this){t.gridCompColumnArr.splice(i,1);break}})},initDataSource:function(){this.dataSourceObj=new dataSource(this.options.dataSource,this)},createDivs:function(){this.ele.innerHTML="";var t="",i="";i+=this.options.width?"width:"+this.options.width+";":"width:auto;",i+=this.options.height?"height:"+this.options.height+";":"height:auto;",""!=i&&(t='style="'+i+'"');var e='<div id="'+this.options.id+'" data-role="grid" class="u-grid" '+t+">";e+="</div>",this.ele.insertAdjacentHTML("afterBegin",e);var e='<div id="'+this.options.id+'_top" class="u-grid-top"></div>';this.ele.insertAdjacentHTML("afterBegin",e),this.initEventFun(),this.widthChangeFun()},repaintDivs:function(){this.repaintGridDivs(),this.realtimeTableRows=null},createGridDivs:function(){if(!this.createGridFlag){$("#"+this.options.id)[0]&&($("#"+this.options.id)[0].innerHTML="");var t='<div id="'+this.options.id+'_grid" class="u-grid-grid">';t+=this.createColumnMenu(),t+=this.createHeader(),t+=this.createContent(),t+="</div>",$("#"+this.options.id)[0]&&$("#"+this.options.id).html(t),this.headerFirstClassFun(),this.initGridEventFun(),this.afterGridDivsCreate(),this.createGridFlag=!0,this.realtimeTableRows=null}},repaintGridDivs:function(){$("#"+this.options.id+"_grid").remove(null,!0),this.showType="",this.wholeWidth=0,this.createGridFlag=!1,this.columnsVisibleFun(),this.widthChangeFun(),this.realtimeTableRows=null},createColumnMenu:function(){var t=this,i='<div class="u-grid-column-menu" id="'+this.options.id+'_column_menu">';return i+='<ul data-role="menu" role="menubar" class="u-grid-column-menu-ul" id="'+this.options.id+'_column_menu_ul">',i+='<li class="u-grid-column-menu-li" role="menuitem">',i+='<div class="u-grid-column-menu-div1" id="'+this.options.id+'_showColumn">',i+='<span class="u-grid-column-menu-span">'+this.transMap.ml_show_column+"</span>",i+='<div class="u-grid-column-menu-div3 fa fa-caret-right"></div>',i+="</div></li>",i+='<li class="u-grid-column-menu-li" role="menuitem">',i+='<div class="u-grid-column-menu-div1" id="'+this.options.id+'_clearSet">',i+='<span class="u-grid-column-menu-span">'+this.transMap.ml_clear_set+"</span>",i+="</div></li>",i+="</ul></div>",i+='<div class="u-grid-column-menu-columns" id="'+this.options.id+'_column_menu_columns">',i+='<ul data-role="menu" role="menubar" class="u-grid-column-menu-columns-ul" id="'+this.options.id+'_column_menu_columns_ul">',$.each(this.gridCompColumnArr,function(e){if(""!=t.getString(this.options.title,"")){i+='<li class="u-grid-column-menu-columns-li" role="menuitem" index="'+e+'">',i+='<div class="u-grid-column-menu-columns-div1">';var o="";this.options.visible&&(o=" checked"),this.options.canVisible||(o+=' style="display:none;"'),i+='<div class="u-grid-column-menu-columns-div2"><input type="checkbox" '+o+"></div>",i+='<span class="u-grid-column-menu-columns-span">'+this.options.title+"</span>",i+="</div></li>"}}),i+="</ul></div>"},createHeader:function(){var t="";this.wholeWidth>0;var i="";this.options.showHeader||(i='style="display:none;"');var e='<div class="u-grid-header" id="'+this.options.id+'_header" '+i+'><div class="u-grid-header-wrap" id="'+this.options.id+'_header_wrap" data-role="resizable" '+t+">";return(this.options.multiSelect||this.options.showNumCol)&&(e+='<div id="'+this.options.id+'_header_left" class="u-grid-header-left" style="width:'+this.leftW+'px;">',this.options.multiSelect&&(e+=iweb.browser.isIE8?'<div class="u-grid-header-multi-select" style="width:'+this.multiWidth+'px;"><input class="u-grid-multi-input"   type="checkbox" id="'+this.options.id+'_header_multi_input"></div>':'<div class="u-grid-header-multi-select  checkbox check-success" style="width:'+this.multiWidth+'px;"><input  class="u-grid-multi-input"  type="checkbox" id="'+this.options.id+'_header_multi_input"><label for="'+this.options.id+'_header_multi_input"></label></div>'),this.options.showNumCol&&(e+='<div class="u-grid-header-num" style="width:'+this.numWidth+'px;"></div>'),e+="</div>"),e+=this.createHeaderTable("fixed"),e+=this.createHeaderTable(),e+="</div>",e+='<div class="u-grid-header-resize-handle" id="'+this.options.id+'_resize_handle"><div class="u-grid-header-resize-handle-inner"></div></div>',e+="</div>"},createHeaderTable:function(t){var i,e,o;"fixed"==t?(i=parseInt(this.leftW),e="absolute;width:"+this.fixedWidth+"px;z-index:11;background:#F9F9F9;",o="fixed_"):(i=parseInt(this.leftW)+parseInt(this.fixedWidth),e="relative;",o="",this.contentMinWidth>0&&(e+="width:"+this.contentMinWidth+"px;"));var n='<table role="grid" id="'+this.options.id+"_header_"+o+'table" style="position:'+e+";left:"+i+'px">';return n+=this.createColgroup(t),n+='<thead role="rowgroup" id="'+this.options.id+"_header_"+o+'thead">',n+=this.createThead(t),n+="</thead></table>"},createColgroup:function(t){var i,e=this,o="<colgroup>";return i="fixed"==t?this.gridCompColumnFixedArr:this.gridCompColumnArr,$.each(i,function(){this.options.visible&&(o+="<col",o+=' style="width:'+e.formatWidth(this.options.width)+'"',o+=">")}),o+="</colgroup>"},createThead:function(t){var i,e=this,o=0,n="";this.options.maxHeaderLevel>1&&(n='style="height:'+this.headerHeight+'px;"');var s='<tr role="row" '+n+">";return i="fixed"==t?this.gridCompColumnFixedArr:this.gridCompColumnArr,$.each(i,function(i){var n=o,d="";0==this.options.visible?(n=-1,d='style="display:none;"'):o++,s+='<th role="columnheader" data-filed="'+this.options.field+'" rowspan="1" class="u-grid-header-th" '+d+'field="'+this.options.field+'" index="'+i+'" visibleIndex="'+n+'"><div style="position:relative;">';var r="";this.options.headerColor&&(r='style="color:'+this.options.headerColor+'"'),s+='<div class="u-grid-header-link" field="'+this.options.field+'" title="'+this.options.title+'" '+r+">"+this.options.title+"</div>",e.options.columnMenu&&"fixed"!=t&&(s+='<div class="u-grid-header-columnmenu fa fa-bars " field="'+this.options.field+'" style="display:none;"></div>'),s+="</div></th>"}),s+="</tr>"},createContent:function(){var t="",i="",e="";if(this.countContentHeight){var o=$("#"+this.options.id)[0].offsetHeight;this.wholeHeight=o,o>0&&(this.contentHeight=parseInt(o)-this.exceptContentHeight>0?parseInt(o)-this.exceptContentHeight:0,this.contentHeight>0&&(t='style="max-height:'+this.contentHeight+'px;"'))}var n='<div id="'+this.options.id+'_content" class="u-grid-content" '+t+">";return(this.options.showNumCol||this.options.multiSelect)&&(n+=this.createContentLeft(),this.contentWidth>this.contentMinWidth||(i="display:none;",e="bottom:0px;"),this.options.showSumRow&&(n+='<div class="u-grid-content-left-sum-bottom" id="'+this.options.id+'_content_left_sum_bottom" style="width:'+(this.leftW+this.fixedWidth)+"px;"+e+'">',n+="</div>"),n+='<div class="u-grid-content-left-bottom" id="'+this.options.id+'_content_left_bottom" style="width:'+(this.leftW+this.fixedWidth)+"px;"+i+'">',n+="</div>"),n+=this.createContentTable("fixed"),n+=this.createContentTable(),n+="</div>"},createContentLeft:function(){var t=this,i="",e=0;return this.options.multiSelect&&(i+='<div class="u-grid-content-left" id="'+this.options.id+'_content_multiSelect" style="width:'+this.multiSelectWidth+'px;">',this.dataSourceObj.rows&&$.each(this.dataSourceObj.rows,function(e){i+=t.createContentLeftMultiSelectRow(this)}),i+="</div>",e+=this.multiSelectWidth),this.options.showNumCol&&(i+='<div class="u-grid-content-left" id="'+this.options.id+'_content_numCol" style="width:'+this.numWidth+"px;left:"+e+'px;">',this.dataSourceObj.rows&&$.each(this.dataSourceObj.rows,function(e){i+=t.createContentLeftNumColRow(e)}),i+="</div>"),i},createContentLeftMultiSelectRow:function(t,i){var e="";!this.options.autoExpand&&t.level>0&&"block"!=i&&(e="display:none;");var o=t.value["$_#_@_id"];if(o||(o=setTimeout(function(){})),iweb.browser.isIE8)var n='<div style="width:'+this.multiSelectWidth+"px;"+e+'" class="u-grid-content-multiSelect " ><input class="u-grid-multi-input" id="checkbox'+o+'" type="checkbox" value="1" ></div>';else var n='<div style="width:'+this.multiSelectWidth+"px;"+e+'" class="u-grid-content-multiSelect checkbox check-success" ><input class="u-grid-multi-input" id="checkbox'+o+'" type="checkbox" value="1" ><label for="checkbox'+o+'"></label></div>';return n},createContentLeftNumColRow:function(t){var i='<div style="width:'+this.numWidth+'px;" class="u-grid-content-num">'+(t+1)+"</div>";return i},createContentTable:function(t){var i,e,o,n,s,d;n=this.countContentHeight&&parseInt(this.contentHeight)>0?"max-height:"+this.contentHeight+"px;":"","fixed"==t?(i=parseInt(this.leftW),e="fixed_",s="fixed-",o='style="position:absolute;width:'+this.fixedWidth+"px;left:"+i+"px;"+n+'"',d='style="width:'+this.fixedWidth+'px;"'):(i=parseInt(this.leftW)+parseInt(this.fixedWidth),e="",s="",o='style="position:relative;left:'+i+"px;"+n,this.contentMinWidth>0&&(o+="width:"+this.contentMinWidth+"px;"),o+='"',d="",this.contentMinWidth>0&&(d=this.contentWidth>0?'style="min-width:'+this.contentMinWidth+"px;width:"+this.contentWidth+'px;"':'style="min-width:'+this.contentMinWidth+'px;"'));var r='<div id="'+this.options.id+"_content_"+e+'div" class="u-grid-content-'+s+'div" '+o+">";return r+='<div style="height:30px;position:absolute;top:-30px;width:100%;"></div><table role="grid" id="'+this.options.id+"_content_"+e+'table" '+d+">",r+=this.createColgroup(t),r+='<thead role="rowgroup" id="'+this.options.id+"_content_"+e+'thead" style="display:none">',r+=this.createThead(t),r+="</thead>",r+=this.createContentRows(t),r+="</table>","fixed"!=t&&(r+=this.createNoRowsDiv()),r+="</div>"},createNoRowsDiv:function(){var t="",i="";this.contentMinWidth>0&&(t+='style="width:'+this.contentMinWidth+'px;"'),this.contentWidth>0&&(i+='style="width:'+this.contentWidth+'px;"');var e='<div class="u-grid-noRowsDiv"'+i+' id="'+this.options.id+'_noRows"></div>';return e+='<div class="u-grid-noRowsShowDiv"'+t+' id="'+this.options.id+'_noRowsShow">'+this.transMap.ml_no_rows+"</div>"},createContentRows:function(t){var i,e=this,o="";return i="fixed"==t?"fixed_":"",this.dataSourceObj.rows&&(o+='<tbody role="rowgroup" id="'+this.options.id+"_content_"+i+'tbody">',$.each(this.dataSourceObj.rows,function(i){o+=e.createContentOneRow(this,t)}),e.options.showSumRow&&this.dataSourceObj.rows&&this.dataSourceObj.rows.length>0&&(o+=e.createSumRow(t)),o+="</tbody>"),o},createContentOneRow:function(t,i,e){var o="";!this.options.autoExpand&&t.level>0&&"block"!=e&&(o='style="display:none"');var n='<tr role="row" '+o+">";return n+=this.createContentOneRowTd(t,i),n+="</tr>"},createContentOneRowForIE:function(t,i,e,o,n){var s=t.insertRow(i+1);s.setAttribute("role","row"),!this.options.autoExpand&&s.level>0&&"block"!=n&&(s.style.display="none"),this.createContentOneRowTdForIE(s,e,o)},repaintRow:function(t){var i=$("#"+this.options.id+"_content_tbody").find('tr[role="row"]')[t],e=$("#"+this.options.id+"_content_fixed_tbody").find('tr[role="row"]')[t],o=this.dataSourceObj.rows[t],n=$(i),s=this.getTrIndex(n);if(iweb.browser.isIE8||iweb.browser.isIE9){$("#"+this.options.id+"_content_table")[0],$("#"+this.options.id+"_content_fixed_table")[0];this.createContentOneRowTdForIE(i,o),this.createContentOneRowTdForIE(e,o,"fixed")}else i.innerHTML=this.createContentOneRowTd(o),e.innerHTML=this.createContentOneRowTd(o,"fixed");var d={};d.begin=s,d.length=1,this.renderTypeFun(d)},createContentOneRowTd:function(t,i){var e,o=this,n="";e="fixed"==i?this.gridCompColumnFixedArr:this.gridCompColumnArr;var s=t.value;return $.each(e,function(){var i=this.options.field,e=$(s).attr(i);e=o.getString(e,""),"object"==$.type(e)&&(e=e.showValue);var d=(this.options.renderType,""),r="",a="",l="";if(o.options.showTree&&this.firstColumn){var h=parseInt(o.treeLeft)*parseInt(t.level);d='style="position:relative;',t.hasChild?r=o.options.autoExpand?'<span class=" fa fa-minus-square-o u-grid-content-tree-span"></span>':'<span class=" fa fa-plus-square-o u-grid-content-tree-span"></span>':h+=16,d+="left:"+h+'px;"'}this.options.visible||(l='style="display:none;"'),this.options.icon&&(a='<span class="'+this.options.icon+'"></span>'),n+='<td role="rowcell"  '+l+' title="'+e.replace(/\</g,"<").replace(/\>/g,">")+'"><div class="u-grid-content-td-div" '+d+">"+r+a+"<span>"+e.replace(/\</g,"&lt;").replace(/\>/g,"&gt;")+"</span></div></td>"}),n},createContentOneRowTdForIE:function(t,i,e){var o,n=this;o="fixed"==e?this.gridCompColumnFixedArr:this.gridCompColumnArr;var s=i.value;$.each(o,function(){var e=this.options.field,o=$(s).attr(e);o=n.getString(o,""),"object"==$.type(o)&&(o=o.showValue);var d=(this.options.renderType,""),r="",a="",l="",h=t.insertCell();if(h.setAttribute("role","rowcell"),h.title=o.replace(/\</g,"<").replace(/\>/g,">"),n.options.showTree&&this.firstColumn){var u=parseInt(n.treeLeft)*parseInt(i.level);d='style="position:relative;',i.hasChild?r=n.options.autoExpand?'<span class=" fa fa-minus-square-o u-grid-content-tree-span"></span>':'<span class=" fa fa-plus-square-o u-grid-content-tree-span"></span>':u+=18,d+="left:"+u+'px;"'}this.options.visible||(h.style.display="none"),this.options.icon&&(a='<span class="'+this.options.icon+'"></span>'),l+='<div class="u-grid-content-td-div" '+d+">"+r+a+"<span>"+o.replace(/\</g,"&lt;").replace(/\>/g,"&gt;")+"</span></div>",h.insertAdjacentHTML("afterBegin",l)})},createSumRow:function(t){if(this.options.showSumRow){var i,e,o=this;"fixed"==t?(i="fixed_",e=this.gridCompColumnFixedArr):(i="",e=this.gridCompColumnArr);var n=parseInt(this.wholeHeight)-this.exceptContentHeight-48-this.scrollBarHeight;n=n>0?n:0;var s='<tr role="row" class="u-grid-content-sum-row" id="'+this.options.id+"_content_"+i+'sum_row" style="top:'+n+'px;">';return $.each(e,function(){var t=this.options.field,i=o.dataSourceObj.getSumValue(t,this,o),e="";this.options.visible||(e='style="display:none;"'),s+='<td role="rowcell" title="'+i+'" '+e+">",this.firstColumn&&(s+='<div class="u-gird-centent-sum-div"><span>'+o.transMap.ml_sum+"</span></div>");var n="";("integer"==this.options.dataType||"float"==this.options.dataType)&&(n='style="text-align: right;"'),s+='<div class="u-grid-content-td-div" '+n+"><span>"+i+"</span></div></td>"}),s+="</tr>"}},createSumRowForIE:function(t,i){if(this.options.showSumRow){var e,o,n=this;"fixed"==i?(e="fixed_",o=this.gridCompColumnFixedArr):(e="",o=this.gridCompColumnArr);var s=parseInt(this.wholeHeight)-this.exceptContentHeight-48-this.scrollBarHeight;s=s>0?s:0;var d=t.insertRow();d.row="row",d.className="u-grid-content-sum-row",d.id=this.options.id+"_content_"+e+"sum_row",d.style.top=s+"px",$.each(o,function(){var t=this.options.field,i=n.dataSourceObj.getSumValue(t,this,n),e=d.insertCell();e.role="rowcell",e.title=i;var o="";("integer"==this.options.dataType||"float"==this.options.dataType)&&(o='style="text-align: right;"');var s='<div class="u-grid-content-td-div" '+o+"><span>"+i+"</span></div>";e.insertAdjacentHTML("afterBegin",s)})}},repairSumRow:function(){if(this.options.showSumRow){$("#"+this.options.id+"_content_div tbody .u-grid-content-sum-row").remove(),$("#"+this.options.id+"_content_fixed_div tbody .u-grid-content-sum-row").remove();try{if(this.dataSourceObj.rows&&this.dataSourceObj.rows.length>0){var t=this.createSumRow();$("#"+this.options.id+"_content_div tbody")[0].insertAdjacentHTML("beforeEnd",t);var t=this.createSumRow("fixed");$("#"+this.options.id+"_content_fixed_div tbody")[0].insertAdjacentHTML("beforeEnd",t)}}catch(i){var e=$("#"+this.options.id+"_content_div table")[0];$("#"+this.options.id+"_content_fixed_div table")[0];this.createSumRowForIE(e),this.createSumRowForIE(e,"fixed")}}},repairContent:function(){var t=$("#"+this.options.id+"_content").parent();if($("#"+this.options.id+"_content").remove(null,!0),t[0]){var i=this.createContent();t[0].insertAdjacentHTML("beforeEnd",i),this.renderTypeFun(),this.initContentDivEventFun(),$("#"+this.options.id+"_content_div")[0]&&($("#"+this.options.id+"_content_div")[0].scrollLeft=this.scrollLeft),$("#"+this.options.id+"_content_edit_menu").css("display","none")}this.realtimeTableRows=null},createFromDivs:function(){if(!this.createFormFlag){var t='<div id="'+this.options.id+'_form" class="u-grid-form">';t+=this.createFromContent(),$("#"+this.options.id)[0].insertAdjacentHTML("afterBegin",t),this.createFormFlag=!0}},createFromContent:function(){var t='<div class="u-grid-form-content" id="'+this.options.id+'_form_content" class="u-grid-content">';return t+='<table role="grid" id="'+this.options.id+'_form_content_table">',t+=this.createFormContentRows(),t+="</table>"},createFormContentRows:function(){var t=this,i="";return this.dataSourceObj.rows&&(i+='<tbody role="rowgroup" id="'+this.options.id+'_form_content_tbody">',$.each(this.dataSourceObj.rows,function(){i+='<tr role="row"><td role="rowcell">';var e=this.value;$.each(t.gridCompColumnArr,function(){var t=this.options.field,o=this.options.title,n=$(e).attr(t);i+="<div>"+o+":</div>",i+="<div>"+n+"</div>"}),i+="</td></tr>"}),i+="</tbody>"),i},initEventFun:function(){var t=this;$("#"+this.options.id).on("mousedown",function(i){if($(i.target).closest("#"+t.options.id+"_header").length>0){t.mouseDownX=i.clientX,t.mouseDownY=i.clientY;var e=$(i.target).closest("th")[0];t.canSwap&&t.swapColumnStart(i,e),i.preventDefault()}else $(i.target).closest("#"+t.options.id+"_content").length>0}),$("#"+this.options.id).on("mousemove",function(i){if($(i.target).closest("#"+t.options.id+"_header").length>0){var e=$(i.target).closest("th")[0];t.headerThDrag(i,e)}t.mouseMoveX=i.clientX,t.mouseMoveY=i.clientY,t.mouseMoveX==t.mouseDownX&&t.mouseDownY==t.mouseMoveY||"mouseDownX"==t.mouseDownX||!t.canSwap||(t.swapColumnFlag=!0),t.dragFun(i),t.swapColumnFun(i),i.stopPropagation()}),$("#"+this.options.id+"_top").on("mousemove",function(i){t.mouseMoveX=i.clientX,t.mouseMoveY=i.clientY,t.mouseMoveX==t.mouseDownX&&t.mouseDownY==t.mouseMoveY||"mouseDownX"==t.mouseDownX||!t.canSwap||(t.swapColumnFlag=!0),t.dragFun(i),t.swapColumnFun(i),i.stopPropagation()}),$("#"+this.options.id).on("mouseup",function(i){if($(i.target).closest("#"+t.options.id+"_header").length>0){if(t.mouseUpX=i.clientX,t.mouseUpY=i.clientY,t.mouseDownX==t.mouseUpX&&t.mouseDownY==t.mouseUpY){t.columnClickX=i.clientX,t.columnClickY=i.clientY;var e=$(i.target).closest("th")[0];if($(i.target).hasClass("u-grid-header-columnmenu")){$("#"+t.options.id+"_column_menu").css("display","block");var o=e.attrRightTotalWidth-t.scrollLeft+t.leftW+t.fixedWidth-20;o+t.columnMenuWidth>t.wholeWidth&&(o=e.attrRightTotalWidth-t.scrollLeft+t.leftW+t.fixedWidth-t.columnMenuWidth+1),$("#"+t.options.id+"_column_menu").css("left",o),$("#"+t.options.id+"_column_menu").css("top",t.headerHeight),t.ele.createColumnMenuFlage=!0}else t.canSortable(i,e)}}else $(i.target).closest("#"+t.options.id+"_content").length>0;t.dragEnd(i),t.swapColumnEnd(i),t.mouseUpX="mouseUpX",t.mouseUpY="mouseUpY",t.mouseDownX="mouseDownX",t.mouseDownY="mouseDownY",t.mouseMoveX="mouseMoveX",t.mouseMoveY="mouseMoveY"}),$("#"+this.options.id+"_top").on("mouseup",function(i){t.dragEnd(i),t.swapColumnEnd(i),t.mouseUpX="mouseUpX",t.mouseUpY="mouseUpY",t.mouseDownX="mouseDownX",t.mouseDownY="mouseDownY",t.mouseMoveX="mouseMoveX",t.mouseMoveY="mouseMoveY"}),$(document).on("click",function(){0==t.columnMenuMove&&0==t.ele.createColumnMenuFlage&&$("#"+t.options.id+"_column_menu",t.$ele).css("display","none"),t.ele.createColumnMenuFlage=!1})},initGridEventFun:function(){var t=this;$("#"+this.options.id+"_resize_handle").on("mousedown",function(i){return t.dragStart(i),!1}),$("#"+this.options.id+"_header_table th").on("mousemove",function(t){$(".u-grid-header-columnmenu",$(this)).css("display","block")}),$("#"+this.options.id+"_header_table th").on("mouseout",function(t){$(".u-grid-header-columnmenu",$(this)).css("display","none")}),this.initContentDivEventFun(),$("#"+this.options.id+"_header_multi_input").on("click",function(i){this.checked?t.setAllRowSelect():t.setAllRowUnSelect()}),$("#"+this.options.id+"_column_menu_ul").on("mousemove",function(i){t.columnMenuMove=!0}),$("#"+this.options.id+"_column_menu_ul").on("mouseout",function(i){t.columnMenuMove=!1}),$("#"+this.options.id+"_showColumn").on("mousemove",function(i){if(t.hideMenuColumns&&clearTimeout(t.hideMenuColumns),"block"!=$("#"+t.options.id+"_column_menu_columns").css("display")){var e=$(window).width(),o=$(window).height(),n=$("#"+t.options.id+"_column_menu").css("left"),s=parseInt(n)+t.columnMenuWidth,d=t.columnClickX+2*t.columnMenuWidth;d>e&&(s=parseInt(n)-t.columnMenuWidth),$("#"+t.options.id+"_column_menu_columns").css("left",s);var r=t.headerHeight,a=i.clientY,l=t.menuColumnsHeight;t.menuColumnsHeight+30>o?(l=o-30,$("#"+t.options.id+"_column_menu_columns").css("height",l+"px")):$("#"+t.options.id+"_column_menu_columns").css("height","");var h=a+l;h>o&&(r=-1*(a-(o-l))+30),$("#"+t.options.id+"_column_menu_columns").css("top",r),$("#"+t.options.id+"_column_menu_columns").css("display","block"),t.columnMenuMove=!0}}),$("#"+this.options.id+"_showColumn").on("mouseout",function(i){t.hideMenuColumns=setTimeout(function(){$("#"+t.options.id+"_column_menu_columns").css("display","none"),t.columnMenuMove=!1},200)}),$("#"+this.options.id+"_column_menu_columns").on("mousemove",function(i){t.hideMenuColumns&&clearTimeout(t.hideMenuColumns),$("#"+t.options.id+"_column_menu_columns").css("display","block"),t.columnMenuMove=!0}),$("#"+this.options.id+"_column_menu_columns").on("mouseout",function(i){t.hideMenuColumns=setTimeout(function(){$("#"+t.options.id+"_column_menu_columns").css("display","none"),t.columnMenuMove=!1},200)}),$("#"+this.options.id+"_clearSet").on("click",function(i){t.clearLocalData(),t.initGridCompColumn(),t.dataSourceObj.sortRows(),t.repaintGridDivs(),"function"==typeof t.options.onClearSetFun&&t.options.onClearSetFun(t)}),$("#"+this.options.id+"_column_menu_columns_ul li input").on("click",function(i){var e=$(this).closest("li").attr("index");if(t.gridCompColumnArr[e].options.visible){$(this)[0].checked=!1;var o=$("input:checked",$("#"+t.options.id+"_column_menu_columns_ul")).length;if(0==o)return void($(this)[0].checked=!0);8==document.documentMode?(t.gridCompColumnArr[e].options.visible=!1,t.repaintGridDivs()):(t.setColumnVisibleByIndex(e,!1),t.gridCompColumnArr[e].options.visible=!1)}else $(this)[0].checked=!0,8==document.documentMode?(t.gridCompColumnArr[e].options.visible=!0,t.repaintGridDivs()):(t.setColumnVisibleByIndex(e,!0),t.gridCompColumnArr[e].options.visible=!0);t.saveGridCompColumnArrToLocal(),i.stopPropagation()}),$("#"+this.options.id+"_column_menu_columns_ul li").on("click",function(i){var e=$(this).attr("index"),o=t.gridCompColumnArr[e];if(!o.options.canVisible)return!1;if(o.options.visible){$("input",$(this))[0].checked=!1;var n=$("input:checked",$("#"+t.options.id+"_column_menu_columns_ul")).length;if(0==n)return void($("input",$(this))[0].checked=!0);t.setColumnVisibleByIndex(e,!1),t.gridCompColumnArr[e].options.visible=!1}else $("input",$(this))[0].checked=!0,t.setColumnVisibleByIndex(e,!0),t.gridCompColumnArr[e].options.visible=!0;t.saveGridCompColumnArrToLocal()})},initContentDivEventFun:function(){var t=this;$("#"+t.options.id+"_content .u-grid-content-left").on("click",function(i){var e=$(i.target).closest("input");if(e.length>0){var o=$(e.parent()),n=$(".u-grid-content-multiSelect",o.parent()).index(o);e[0].checked?t.setRowSelect(n):t.setRowUnselect(n)}}),$("#"+this.options.id+"_content_div").on("scroll",function(i){t.scrollLeft=this.scrollLeft,t.scrollTop=this.scrollTop,$("#"+t.options.id+"_header_table").css("left",t.leftW-t.scrollLeft+t.fixedWidth+"px"),$("#"+t.options.id+"_noRowsShow").css("left",t.scrollLeft+"px"),$("#"+t.options.id+"_edit_form").css("left",t.scrollLeft+"px"),$("#"+t.options.id+"_content_multiSelect").css("top",-t.scrollTop+"px"),$("#"+t.options.id+"_content_numCol").css("top",-t.scrollTop+"px"),$("#"+t.options.id+"_content_fixed_div").css("top",-t.scrollTop+"px")}),$("#"+this.options.id+"_content_tbody").on("click",function(i){"function"==typeof t.options.onDblClickFun?t.isDblEvent("tbodyClick",t.dblClickFun,i,t.clickFun,i):t.clickFun(i)}),$("#"+this.options.id+"_content_fixed_tbody").on("click",function(i){"function"==typeof t.options.onDblClickFun?t.isDblEvent("tbodyClick",t.dblClickFun,i,t.clickFun,i):t.clickFun(i)}),$("#"+this.options.id+"_content_tbody").on("mousemove",function(i){var e=$(i.target).closest("tr");if($("#"+t.options.id+"_content_tbody").find("tr").removeClass("u-grid-move-bg"),$("#"+t.options.id+"_content_fixed_tbody").find("tr").removeClass("u-grid-move-bg"),t.options.multiSelect&&$("#"+t.options.id+"_content_multiSelect").find("div").removeClass("u-grid-move-bg"),t.options.showNumCol&&$("#"+t.options.id+"_content_numCol").find("div").removeClass("u-grid-move-bg"),(!e[0].id||e[0].id!=t.options.id+"_edit_tr")&&e.length>0){var o=$("tr",e.parent()).index(e);$("#"+t.options.id+"_content_tbody").find("tr").eq(o).addClass("u-grid-move-bg"),$("#"+t.options.id+"_content_fixed_tbody").find("tr").eq(o).addClass("u-grid-move-bg"),t.options.multiSelect&&$("#"+t.options.id+"_content_multiSelect").find("div").eq(o).addClass("u-grid-move-bg"),t.options.showNumCol&&$("#"+t.options.id+"_content_numCol").find("div").eq(o).addClass("u-grid-move-bg")}}),$("#"+this.options.id+"_content_fixed_tbody").on("mousemove",function(i){var e=$(i.target).closest("tr");if($("#"+t.options.id+"_content_tbody").find("tr").removeClass("u-grid-move-bg"),$("#"+t.options.id+"_content_fixed_tbody").find("tr").removeClass("u-grid-move-bg"),t.options.multiSelect&&$("#"+t.options.id+"_content_multiSelect").find("div").removeClass("u-grid-move-bg"),t.options.showNumCol&&$("#"+t.options.id+"_content_numCol").find("div").removeClass("u-grid-move-bg"),(!e[0].id||e[0].id!=t.options.id+"_edit_tr")&&e.length>0){var o=$("tr",e.parent()).index(e);$("#"+t.options.id+"_content_tbody").find("tr").eq(o).addClass("u-grid-move-bg"),$("#"+t.options.id+"_content_fixed_tbody").find("tr").eq(o).addClass("u-grid-move-bg"),t.options.multiSelect&&$("#"+t.options.id+"_content_multiSelect").find("div").eq(o).addClass("u-grid-move-bg"),t.options.showNumCol&&$("#"+t.options.id+"_content_numCol").find("div").eq(o).addClass("u-grid-move-bg")}}),$("#"+this.options.id+"_content").on("mouseout",function(i){$("#"+t.options.id+"_content_tbody").find("tr").removeClass("u-grid-move-bg"),$("#"+t.options.id+"_content_fixed_tbody").find("tr").removeClass("u-grid-move-bg"),t.options.multiSelect&&$("#"+t.options.id+"_content_multiSelect").find("div").removeClass("u-grid-move-bg"),t.options.showNumCol&&$("#"+t.options.id+"_content_numCol").find("div").removeClass("u-grid-move-bg")})},setIntervalFun:function(t){this.widthChangeFun(),this.heightChangeFun(),this.editorRowChangeFun();
},editorRowChangeFun:function(){if($("#"+this.options.id+"_edit_form").length>0){var t=$("#"+this.options.id+"_edit_form")[0].offsetHeight;$("#"+this.options.id+"_numCol_edit").css("height",t),$("#"+this.options.id+"_multiSelect_edit").css("height",t)}},afterGridDivsCreate:function(){this.columnsVisibleFun(),this.resetThVariable(),this.countRowHeight(),this.noRowsShowFun();this.renderTypeFun(),this.resetScrollLeft(),this.hideEditMenu()},countRowHeight:function(){$("#"+this.options.id+"_content_tbody tr")[0]&&(this.rowHeight=$("#"+this.options.id+"_content_tbody tr")[0].offsetHeight)},noRowsShowFun:function(){this.dataSourceObj.rows&&this.dataSourceObj.rows.length>0?($("#"+this.options.id+"_noRowsShow").css("display","none"),$("#"+this.options.id+"_noRows").css("display","none")):($("#"+this.options.id+"_noRowsShow").css("display","block"),$("#"+this.options.id+"_noRows").css("display","block"))},updateLastRowFlag:function(){for(var t=$("#"+this.options.id+"_content_tbody").find("tr[role=row]"),i=0,e=t.length;e>i;i++)i==e-1?$(t[i]).addClass("last-row"):$(t[i]).removeClass("last-row")},updateNumColLastRowFlag:function(){for(var t=$("#"+this.options.id+"_content_numCol").find(".u-grid-content-num"),i=0,e=t.length;e>i;i++)i==e-1?$(t[i]).addClass("last-row"):$(t[i]).removeClass("last-row")},renderTypeFun:function(t){if("undefined"==typeof t)var i=null,e=null,o="";else var i="undefined"==typeof t.begin?null:t.begin,e="undefined"==typeof t.length?null:t.length,o="undefined"==typeof t.field?"":t.field;var n=this,i=parseInt(i),e=parseInt(e),s=i;if(e>0&&(s=parseInt(i+e-1)),""==o)$.each(this.gridCompColumnFixedArr,function(t){n.renderTypeByColumn(this,t,i,e,!0)}),$.each(this.gridCompColumnArr,function(t){n.renderTypeByColumn(this,t,i,e,!1)});else{var d=!1;$.each(this.gridCompColumnFixedArr,function(t){return this.options.field==o?(n.renderTypeByColumn(this,t,i,e,!0),void(d=!0)):void 0}),d||$.each(this.gridCompColumnArr,function(t){return this.options.field==o?void n.renderTypeByColumn(this,t,i,e,!1):void 0})}},renderTypeByColumn:function(t,i,e,o,n){var s=this,d=t.options.renderType,r=t.options.sumCol,a=t.options.sumRenderType,l=t.options.dataType,h=t.options.precision,u=t.options.format,c=t.options.field,p=e,m=n===!0?"_content_fixed_tbody":"_content_tbody",f=n===!0?"fixed_":"";o>0&&(p=parseInt(e+o-1)),this.realtimeTableRows=document.getElementById(s.options.id+m).children;for(var v=-1,w=0;w<s.realtimeTableRows.length;w++)"row"!=s.realtimeTableRows[w].getAttribute("role")&&(v=w);if($.each(s.dataSourceObj.rows,function(o){if(e>=0&&o>=e&&p>=o||isNaN(e)){var n=o;-1!=v&&o>=v&&n++;var r=s.realtimeTableRows[n],a=r.children[i];if(a){if(-1!=a.children[0].innerHTML.indexOf("u-grid-content-tree-span"))var m=a.children[0].children[1];else var m=a.children[0];if(m){var f=$(this.value).attr(c);if("function"==typeof d||"date"==l||"datetime"==l||"integer"==l||"float"==l)if(m.innerHTML="","function"==typeof d){f=s.getString(f,"");var w={};w.value=f,w.element=m,w.gridObj=s,w.row=this,w.gridCompColumn=t,w.rowIndex=o,d.call(s,w)}else if("date"==l||"datetime"==l){(null==f||f==undefined||"null"==f||"undefined"==f||""==f)&&(f="");var g=new Date(f);parseInt(g.valueOf())>0?f=g.format(u):(g=moment(f,"YYYY-MM-DD HH:mm:ss").toDate(),parseInt(g.valueOf())>0&&(f=g.format(u))),m.innerHTML=f,a.title=f}else if("integer"==l)f=parseInt(f),m.innerHTML=f,a.title=f;else if("float"==l){if(h){var _={};_.value=f,_.precision=h,f=s.DicimalFormater(_)}else f=parseFloat(f);m.innerHTML=f,a.title=f}else{f=s.getString(f,"");var C=f.replace(/\</g,"<");C=C.replace(/\>/g,">"),a.title=f,f=f.replace(/\</g,"&lt;"),f=f.replace(/\>/g,"&gt;"),m.innerHTML=f}else{f=s.getString(f,"");var C=f.replace(/\</g,"<");C=C.replace(/\>/g,">"),a.title=f,f=f.replace(/\</g,"&lt;"),f=f.replace(/\>/g,"&gt;"),m.innerHTML=f}}}}}),r){var g=$("#"+this.options.id+"_content_"+f+"sum_row").find("td").eq(i).find("span:last-child")[0];if(g)if("function"==typeof a){var _=g.innerHTML,C={};C.value=_,C.element=g,C.gridObj=s,C.gridCompColumn=t,a.call(s,C)}else("integer"==l||"float"==l)&&(g.style.textAlign="right")}},afterRepaintGrid:function(){this.resetScrollLeft(),this.hideEditMenu()},resetScrollLeft:function(){$("#"+this.options.id+"_content_div")[0]&&($("#"+this.options.id+"_content_div")[0].scrollLeft=this.scrollLeft)},hideEditMenu:function(){$("#"+this.options.id+"_content_edit_menu").css("display","none")},widthChangeFun:function(){var t=this;if($("#"+this.options.id)[0]){var i=$("#"+this.options.id).width();this.wholeWidth!=i&&(this.wholeWidth=i,i>300&&("form"==this.showType||""==this.showType||!$("#"+this.options.id+"_content_div tbody")[0])?t.widthChangeGridFun():i>0&&300>i&&("grid"==this.showType||""==this.showType),i>300&&(this.contentMinWidth=parseInt(this.wholeWidth)-parseInt(this.leftW)-parseInt(this.fixedWidth),this.contentMinWidth<0&&(this.contentMinWidth=0),setTimeout(function(){$("#"+t.options.id+"_header_wrap").css("max-width",t.wholeWidth-4+"px"),$("#"+t.options.id+"_content_div").css("width",t.contentMinWidth+"px"),$("#"+t.options.id+"_content_table").css("min-width",t.contentMinWidth+"px"),$("#"+t.options.id+"_content_table").css("width",t.contentMinWidth+"px"),$("#"+t.options.id+"_header_table").css("min-width",t.contentMinWidth+"px"),$("#"+t.options.id+"_header_table").css("width",t.contentMinWidth+"px"),"function"==typeof t.options.afterCreate&&t.options.afterCreate.call(t)},300))),$("#"+t.options.id+"_header_table").css("width",t.contentMinWidth+"px"),$("#"+t.options.id+"_edit_form").css("width",t.contentMinWidth+"px")}},widthChangeGridFun:function(){var t=parseInt(this.wholeWidth/2);if(this.fixedRealWidth>t?this.fixedWidth=t:this.fixedWidth=this.fixedRealWidth,this.contentMinWidth=parseInt(this.wholeWidth)-parseInt(this.leftW)-parseInt(this.fixedWidth),this.contentMinWidth<0&&(this.contentMinWidth=0),this.contentRealWidth<this.contentMinWidth){this.contentWidth=this.contentMinWidth;var i=this.lastVisibleColumn.options.width;this.lastVisibleColumnWidth=i+(this.contentMinWidth-this.contentRealWidth),this.lastVisibleColumn.options.width=this.lastVisibleColumnWidth-20}else this.contentWidth=this.contentRealWidth;this.createGridFlag=!1,this.createGridDivs(),$("#"+this.options.id+"_form").css("display","none"),$("#"+this.options.id+"_grid").css("display","block"),this.showType="grid"},widthChangeFormFun:function(){this.createFromDivs(),$("#"+this.options.id+"_grid").css("display","none"),$("#"+this.options.id+"_form").css("display","block"),this.showType="form","function"==typeof this.options.afterCreate&&this.options.afterCreate.call(this)},heightChangeFun:function(){if(this.countContentHeight){var t=this.wholeHeight,i=$("#"+this.options.id)[0].offsetHeight;if(this.wholeHeight=i,t!=i){var e=i-this.exceptContentHeight>0?i-this.exceptContentHeight:0;$("#"+this.options.id+"_content").css("height",e+"px"),$("#"+this.options.id+"_content_div").css("height",e+"px")}}},columnsVisibleFun:function(){var t=this,i=0,e=0;this.firstColumn=!0,$.each(this.gridCompColumnFixedArr,function(){this.options.visible&&(i+=parseInt(this.options.width),this.firstColumn=t.firstColumn,t.firstColumn=!1)}),this.fixedRealWidth=i,$.each(this.gridCompColumnArr,function(){this.options.visible&&(e+=parseInt(this.options.width),this.firstColumn=t.firstColumn,t.firstColumn=!1,t.lastVisibleColumn=this,t.lastVisibleColumnWidth=this.options.width)}),this.contentRealWidth=e},resetThVariable:function(){var t=this;this.contentWidth=0;var i="",e=0;$("#"+this.options.id+"_header_table th",this.$ele).each(function(o){var n=t.gridCompColumnArr[o],s=t.getString(n.options.parentHeader,""),d=0;if(n.options.visible&&(d=n.options.width),this.attrLeftTotalWidth=t.contentWidth,t.contentWidth+=d,!$("#"+t.options.id+"_resize_handle")[0].nowTh&&n.options.canDrag&&($("#"+t.options.id+"_resize_handle").css("left",d-4+t.leftW),$("#"+t.options.id+"_resize_handle")[0].nowTh=this),this.gridCompColumn=n,this.attrWidth=d,this.attrRightTotalWidth=t.contentWidth,""!=i&&s!=i&&$("#"+t.options.id+i).css("width",e-1+"px"),""!=s){var r=t.getLevelTitleByField(s);if(s!=i&&(e=0,!t.parentFlag)){var a='<div id="'+t.options.id+s+'" class="u-gird-parent"><div class="u-grid-header-link" title="'+r+'">'+r+"</div></div>";this.insertAdjacentHTML("afterBegin",a)}e+=d}i=s}),""!=i&&$("#"+t.options.id+i).css("width",e-1+"px"),this.parentFlag=!0},contentWidthChange:function(t){if(t<this.contentMinWidth){var i=this.lastVisibleColumn.options.width;this.lastVisibleColumnWidth=i+(this.contentMinWidth-t),$("#"+this.options.id+"_header_table col:last").css("width",this.lastVisibleColumnWidth+"px"),$("#"+this.options.id+"_content_table col:last").css("width",this.lastVisibleColumnWidth+"px"),t=this.contentMinWidth}return $("#"+this.options.id+"_content_table").css("width",t+"px"),$("#"+this.options.id+"_noRows").css("width",t+"px"),t>this.contentMinWidth?($("#"+this.options.id+"_content_left_bottom").css("display","block"),$("#"+this.options.id+"_content_left_sum_bottom").css("bottom",16)):($("#"+this.options.id+"_content_left_bottom").css("display","none"),$("#"+this.options.id+"_content_left_sum_bottom").css("bottom",0)),t},getColumnAttr:function(t,i){for(var e=0;e<this.gridCompColumnArr.length;e++)if(this.gridCompColumnArr[e].options.field==i)return $(this.gridCompColumnArr[e].options).attr(t);return""},getColumnByField:function(t){for(var i=0;i<this.gridCompColumnArr.length;i++)if(this.gridCompColumnArr[i].options.field==t)return this.gridCompColumnArr[i];return null},getIndexOfColumn:function(t){for(var i=-1,e=0;e<this.gridCompColumnArr.length;e++)if(this.gridCompColumnArr[e]==t){i=e;break}return i},getVisibleIndexOfColumn:function(t){for(var i=-1,e=0,o=0;o<this.gridCompColumnArr.length;o++){if(this.gridCompColumnArr[o]==t){"none"!=$("#"+this.options.id+"_header").find("th").eq(o).css("display")&&(i=e);break}"none"!=$("#"+this.options.id+"_header").find("th").eq(o).css("display")&&e++}return i},getNextVisibleInidexOfColumn:function(t){for(var i=-1,e=!1,o=0,n=0;n<this.gridCompColumnArr.length;n++)if(this.gridCompColumnArr[n]!=t){if(1==e&&"none"!=$("#"+this.options.id+"_header").find("th").eq(n).css("display")){i=o;break}"none"!=$("#"+this.options.id+"_header").find("th").eq(n).css("display")&&o++}else e=!0;return i},headerFirstClassFun:function(){$("#"+this.options.id+"_grid .u-grid-header-th-first").removeClass("u-grid-header-th-first"),$("#"+this.options.id+"_grid").find("th").eq(0).addClass("u-grid-header-th-first")},isDblEvent:function(t,i,e,o,n){if(null!=this.currentEventName&&this.currentEventName==t)i.call(this,e),this.currentEventName=null,this.cleanCurrEventName&&clearTimeout(this.cleanCurrEventName);else{var s=this;this.cleanCurrEventName&&clearTimeout(this.cleanCurrEventName),this.currentEventName=t,this.cleanCurrEventName=setTimeout(function(){s.currentEventName=null,o.call(s,n)},500)}},dblClickFun:function(t){if("function"==typeof this.options.onDblClickFun){var i=$(t.target).closest("tr");if(i[0].id==this.options.id+"_edit_tr")return;var e=0;i.length>0&&(e=this.getTrIndex(i));var o={};o.gridObj=this,o.rowObj=this.dataSourceObj.rows[e],o.rowIndex=e,this.options.onDblClickFun(o)}},clickFun:function(t){var i=this,e=$(t.target),o=e.closest("td"),n=o.index();if(o.length>0){var s=o.parent(),d=this.getTrIndex(s),r=i.dataSourceObj.rows[d];if(r){var a=r.childRowIndex;if(e.hasClass("fa-minus-square-o")||e.hasClass("fa-plus-square-o")){var l=o.find(".fa-minus-square-o"),h=o.find(".fa-plus-square-o");if(l.length>0){if(l.removeClass("fa-minus-square-o").addClass("fa-plus-square-o"),a.length>0){var u=i.getAllChildRowIndex(r);$.each(u,function(){var t=$('tr[role="row"]:eq('+parseInt(this)+")",s.parent());t.css("display","none"),$("#"+i.options.id+"_content_multiSelect >div:nth-child("+(parseInt(this)+1)+")").css("display","none"),$(".fa-minus-square-o",t).removeClass("fa-minus-square-o").addClass("fa-plus-square-o")})}return void("form"==this.options.editType&&($("#"+this.options.id+"_multiSelect_edit").remove(null,!0),$("#"+this.options.id+"_numCol_edit").remove(null,!0),$("#"+this.options.id+"_edit_tr").remove(null,!0),$("#"+this.options.id+"_edit_tr1").remove(null,!0)))}if(h.length>0)return h.removeClass("fa-plus-square-o").addClass("fa-minus-square-o"),void(a.length>0&&$.each(a,function(){var t=$('tr[role="row"]:eq('+parseInt(this)+")",s.parent());t.css("display","");$("#"+i.options.id+"_content_multiSelect >div:nth-child("+(parseInt(this)+1)+")")[0];$("#"+i.options.id+"_content_multiSelect >div:nth-child("+(parseInt(this)+1)+")").css("display","")}))}}}var s=$(t.target).closest("tr");if(!(s.length>0&&s[0].id==this.options.id+"_edit_tr")&&s.length>0){var d=this.getTrIndex(s),r=i.dataSourceObj.rows[d];if(r){if(i.options.rowClickBan)return;var a=r.childRowIndex;i.dataSourceObj.rows[d].focus&&i.options.cancelFocus?i.setRowUnFocus(d):i.dataSourceObj.rows[d].focus||i.setRowFocus(d),i.options.editable&&(i.eidtRowIndex!=d||"default"==i.options.editType&&i.editColIndex!=n)&&i.editRowFun(s,n)}}},setColumnVisibleByColumn:function(t,i){var e=this.getIndexOfColumn(t);this.setColumnVisibleByIndex(e,i)},setColumnVisibleByIndex:function(t,i){if(t>=0){var e=this.gridCompColumnArr[t],o=this.getVisibleIndexOfColumn(e);if(0==e.options.visible&&i){var n="<col";e.options.width&&(n+=' style="width:'+this.formatWidth(e.options.width)+'"'),n+=">",$("#"+this.options.id+"_header th:eq("+t+")").css("display",""),$("#"+this.options.id+"_content th:eq("+t+")").css("display",""),$("td:eq("+t+")",$("#"+this.options.id+"_content tbody tr")).css("display","");var s=this.getNextVisibleInidexOfColumn(e);if(-1==s)try{$("#"+this.options.id+"_header col:last")[0].insertAdjacentHTML("afterEnd",n),$("#"+this.options.id+"_content col:last")[0].insertAdjacentHTML("afterEnd",n)}catch(d){$("#"+this.options.id+"_header col:last").after(n),$("#"+this.options.id+"_content col:last").after(n)}else try{$("#"+this.options.id+"_header col:eq("+s+")")[0].insertAdjacentHTML("beforeBegin",n),$("#"+this.options.id+"_content col:eq("+s+")")[0].insertAdjacentHTML("beforeBegin",n)}catch(d){$("#"+this.options.id+"_header col:eq("+s+")").before(n),$("#"+this.options.id+"_content col:eq("+s+")").before(n)}var r=this.contentWidth+e.options.width}if(1==e.options.visible&&!i){$("#"+this.options.id+"_header th:eq("+t+")").css("display","none"),$("#"+this.options.id+"_header col:eq("+o+")").remove(),$("#"+this.options.id+"_content th:eq("+t+")").css("display","none"),$("#"+this.options.id+"_content col:eq("+o+")").remove(),$("td:eq("+t+")",$("#"+this.options.id+"_content tbody tr")).css("display","none");var r=this.contentWidth-e.options.width}e.options.visible=i,this.columnsVisibleFun();var a=this.contentWidthChange(r);this.lastVisibleColumn.options.width=this.lastVisibleColumnWidth,this.contentWidth=a,this.resetThVariable(),this.saveGridCompColumnArrToLocal()}},dragStart:function(t){this.dragFlag=!0,this.dragW=null,this.dragStartX=t.clientX},dragFun:function(t){if(this.dragFlag){var i=$("#"+this.options.id+"_resize_handle")[0].nowTh,e=$(i),o=e.attr("index"),n=this.gridCompColumnArr[o];if(nowVisibleThIndex=this.getVisibleIndexOfColumn(n),i&&n!=this.lastVisibleColumn){this.dragEndX=t.clientX;var s=this.dragEndX-this.dragStartX,d=i.attrWidth+s;cWidth=this.contentWidth+s,d>this.minColumnWidth&&(this.dragW=this.contentWidthChange(cWidth),$("#"+this.options.id+"_header_table col:eq("+nowVisibleThIndex+")").css("width",d+"px"),$("#"+this.options.id+"_content_table col:eq("+nowVisibleThIndex+")").css("width",d+"px"),n.options.width=d)}$("#"+this.options.id+"_top").css("display","block")}},dragEnd:function(t){this.dragFlag&&(this.resetThVariable(),this.saveGridCompColumnArrToLocal()),this.lastVisibleColumn.options.width=this.lastVisibleColumnWidth,this.dragW&&(this.contentWidth=this.dragW),$("#"+this.options.id+"_resize_handle")[0].nowTh=null,this.dragFlag=!1,$("#"+this.options.id+"_top").css("display","none")},headerThDrag:function(t,i){if(!this.dragFlag&&!this.swapColumnFlag&&i&&i.gridCompColumn&&i.gridCompColumn.options.canDrag&&$("#"+this.options.id+"_resize_handle")[0].nowTh!=i){$(i);$("#"+this.options.id+"_resize_handle").css("left",i.attrRightTotalWidth-this.scrollLeft-4+this.leftW+this.fixedWidth),$("#"+this.options.id+"_resize_handle")[0].nowTh=i}},swapColumnStart:function(t,i){this.canSwap&&(this.swapColumnEle=i,this.swapColumnStartX=t.clientX,this.swapColumnStartY=t.clientY)},swapColumnFun:function(t){if(this.canSwap){var i=this;if(this.swapColumnFlag){var e=this.swapColumnEle,o=$(e),n=e.gridCompColumn;if(0==$("#"+this.options.id+"_clue").length){var s=$('<div class="u-grid u-grid-header-drag-clue" id="'+this.options.id+'_clue" />').css({width:e.scrollWidth+"px",left:e.attrLeftTotalWidth-i.scrollLeft+i.leftW+i.fixedWidth+"px",top:"0px",paddingLeft:o.css("paddingLeft"),paddingRight:o.css("paddingRight"),lineHeight:o.height()+"px",paddingTop:o.css("paddingTop"),paddingBottom:o.css("paddingBottom")}).html(n.options.title||n.options.field).prepend('<span class="fa fa-ban u-grid-header-drag-status" />');$("#"+this.options.id)[0].insertAdjacentElement("afterBegin",s[0]),s.on("mousemove",function(){t.stopPropagation()})}this.swapColumnEndX=t.clientX,this.swapColumnEndY=t.clientY;var d=this.swapColumnEndX-this.swapColumnStartX,r=this.swapColumnEndY-this.swapColumnStartY;if($("#"+this.options.id+"_clue").css({left:e.attrLeftTotalWidth+d-i.scrollLeft+i.leftW+i.fixedWidth+"px",top:r+"px"}),0==$("#"+this.options.id+"_swap_top").length){var s=$('<span class="fa fa-sort-desc u-grid-header-swap-tip-span"  id="'+this.options.id+'_swap_top"/>');s.css({top:o.height()-6+"px"});var a=$('<span class="fa fa-sort-asc u-grid-header-swap-tip-span" id="'+this.options.id+'_swap_down" />');a.css({top:"6px"}),$("#"+this.options.id)[0].insertAdjacentElement("afterBegin",s[0]),$("#"+this.options.id)[0].insertAdjacentElement("afterBegin",a[0])}this.canSwap=!1,$("#"+this.options.id+"_header_table th").each(function(e){var o=$(this).offset().left,n=o+parseInt(this.attrWidth);if(0==e&&t.clientX<o)i.swapColumnEle!=this&&(i.swapToColumnEle="LeftEle",$("#"+i.options.id+"_swap_top").css({left:-i.scrollLeft-3+i.leftW+i.fixedWidth+"px",display:"block"}),$("#"+i.options.id+"_swap_down").css({left:-i.scrollLeft-3+i.leftW+i.fixedWidth+"px",display:"block"})),i.canSwap=!0;else if(o<t.clientX&&t.clientX<n&&i.swapColumnEle!=this&&parseInt($(this).attr("index"))+1!=parseInt($(i.swapColumnEle).attr("index")))return i.swapToColumnEle!=this&&(i.swapToColumnEle=this,$("#"+i.options.id+"_swap_top").css({left:this.attrRightTotalWidth-i.scrollLeft-3+i.leftW+i.fixedWidth+"px",display:"block"}),$("#"+i.options.id+"_swap_down").css({left:this.attrRightTotalWidth-i.scrollLeft-3+i.leftW+i.fixedWidth+"px",display:"block"})),i.canSwap=!0,!1}),this.canSwap?$(".u-grid-header-drag-status").removeClass("fa-ban").addClass("fa-plus-circle"):($("#"+this.options.id+"_swap_top").css("display","none"),$("#"+this.options.id+"_swap_down").css("display","none"),$(".u-grid-header-drag-status").removeClass("fa-plus-circle").addClass("fa-ban"),this.swapToColumnEle=null),$("#"+this.options.id+"_top").css("display","block")}}},swapColumnEnd:function(t){if(this.canSwap){if(this.swapColumnFlag){if(this.swapToColumnEle){var i=this.swapColumnEle,e=this.swapToColumnEle,o=$(i).attr("index"),n=$(e).attr("index"),s=this.gridCompColumnArr[o];this.gridCompColumnArr.splice(parseInt(n)+1,0,s),n>o?this.gridCompColumnArr.splice(o,1):this.gridCompColumnArr.splice(parseInt(o)+1,1),this.saveGridCompColumnArrToLocal(),this.repaintGridDivs()}$("#"+this.options.id+"_clue").remove(),$("#"+this.options.id+"_swap_top").css("display","none"),$("#"+this.options.id+"_swap_down").css("display","none")}this.swapColumnFlag=!1,$("#"+this.options.id+"_top").css("display","none")}},canSortable:function(t,i){var e=this,o=$(i),n=o.attr("field"),s=this.getColumnAttr("sortable",n);if(s){if(t.ctrlKey){var d=[];$(".u-grid-header-sort-priority").each(function(t,i){var e,o=$(i),n=parseInt(o.text()),s=o.closest("th").attr("field");o.parent().hasClass("fa-angle-up")?e="asc":o.parent().hasClass("fa-angle-down")&&(e="desc"),d[n-1]={field:s,sortType:e}});var r;if((r=o.find(".fa-angle-up")).length>0){var a=parseInt(r.find(".u-grid-header-sort-priority").text());d[a-1].sortType="desc",r.removeClass("fa-angle-up").addClass("fa-angle-down")}else if((r=o.find(".fa-angle-down")).length>0){for(var a=parseInt(r.find(".u-grid-header-sort-priority").text()),l=a;l<d.length;l++){var h=$("[field="+d[l].field+"]").find(".u-grid-header-sort-priority");h.text(parseInt(h.text())-1)}d.splice(a-1,1),r.remove()}else d.push({field:n,sortType:"asc"}),o.first().append('<span class="fa fa-angle-up u-grid-header-sort-span" ><span class="u-grid-header-sort-priority">'+d.length+"</span></span>");this.dataSourceObj.sortRowsByPrio(d)}else $(".fa-angle-up").parent().parent()[0]==i?($(".fa-angle-up").remove(),$(i.firstChild)[0].insertAdjacentHTML("beforeEnd",'<span class="fa fa-angle-down u-grid-header-sort-span" ><span class="u-grid-header-sort-priority">1</span></span>'),"function"==typeof this.options.onSortFun?this.options.onSortFun(n,"asc"):this.dataSourceObj.sortRows(n,"asc")):$(".fa-angle-down").parent().parent()[0]==i?($(".fa-angle-down").remove(),"function"==typeof this.options.onSortFun?this.options.onSortFun():this.dataSourceObj.sortRows()):($(".fa-angle-up").remove(),$(".fa-angle-down").remove(),$(i.firstChild)[0].insertAdjacentHTML("beforeEnd",'<span class="fa fa-angle-up u-grid-header-sort-span"><span class="u-grid-header-sort-priority">1</span></span>'),"function"==typeof this.options.onSortFun?this.options.onSortFun(n,"desc"):this.dataSourceObj.sortRows(n,"desc"));e.repairContent(),e.afterGridDivsCreate()}},editRowFun:function(t,i){-1!=this.eidtRowIndex&&this.editClose();var e="number"==typeof t?t:this.getTrIndex(t);this.eidtRowIndex=e,this.editColIndex=i,this.editRow(t,i)},editRowIndexFun:function(t){-1!=this.eidtRowIndex&&this.editClose(),this.eidtRowIndex=t,this.editColIndex=0,this.editRow()},editRow:function(t,i){var e=this,o=!1;t&&t.parents("table").attr("id").indexOf("_fixed_")>-1&&(o=!0),t=t||$("#"+this.options.id+'_content_tbody tr[role="row"]:eq('+this.eidtRowIndex+")"),i=i||0;var n=this.dataSourceObj.rows[this.eidtRowIndex].value;if(this.editRowObj=this.cloneObj(n),"default"==this.options.editType){var s=o?this.gridCompColumnFixedArr[i]:this.gridCompColumnArr[i];if(s.options.editable){var d=$("td:eq("+i+")",t)[0],r=s.options.field,a=$(n).attr(r);a=e.getString(a,""),e.editCell(d,a,r,s.options.editType,e.editRowObj)}$("#"+this.options.id+"_content_edit_menu").css("display","block"),$("#"+this.options.id+"_content_edit_menu_cancel").css("marginLeft","10px");var l=$("tr:visible",t.parent()).index(t);this.rowHeight=t.height();this.rowHeight*(l+1)+this.headerHeight+1}else if("form"==this.options.editType)if("function"==typeof this.options.formEditRenderFun){if(this.fixedWidth>0)var h=$("#"+this.options.id+"_content_fixed_table")[0];else var h=$("#"+this.options.id+"_content_table")[0];var u=h.insertRow(this.eidtRowIndex+2);u.id=this.options.id+"_edit_tr";var c=u.insertCell();c.id=this.options.id+"_edit_td",c.style.borderBottom="0px";var p=parseInt(this.contentMinWidth)+parseInt(this.fixedWidth),m='<div id="'+this.options.id+'_edit_form" class="u-grid-edit-form" style="width:'+p+'px;float:left;">';m+="</div>",c.innerHTML=m;var f={};f.grid=gridObj,f.element=$("#"+this.options.id+"_edit_form")[0],f.editRowObj=this.editRowObj,this.options.formEditRenderFun.call(this,f);var m='<div style="position:relative;float:left;width:100%;height:40px;"></div>';$("#"+this.options.id+"_edit_form")[0].insertAdjacentHTML("beforeEnd",m);var v=$("#"+this.options.id+"_edit_td")[0].offsetHeight,w=$("#"+this.options.id+"_edit_form").css("background-color");if(this.options.multiSelect){var g=$("#"+this.options.id+"_content_multiSelect > div").eq(this.eidtRowIndex),m='<div class="grid_open_edit" id="'+this.options.id+'_multiSelect_edit" style="background-color:'+w+";float:left;position:relative;width:"+this.multiSelectWidth+"px;height:"+v+'px"></div>';g[0].insertAdjacentHTML("afterEnd",m)}if(this.options.showNumCol){var g=$("#"+this.options.id+"_content_numCol > .u-grid-content-num").eq(this.eidtRowIndex),m='<div id="'+this.options.id+'_numCol_edit" style="background-color:'+w+";float:left;position:relative;width:"+this.numWidth+'px;"></div>';g[0].insertAdjacentHTML("afterEnd",m)}if($("#"+this.options.id+"_content_edit_menu").css("display","block"),this.fixedWidth>0){var _=$("#"+this.options.id+"_content_table")[0],C=_.insertRow(this.eidtRowIndex+2);C.id=this.options.id+"_edit_tr1"}}else{if(this.fixedWidth>0)var h=$("#"+this.options.id+"_content_fixed_table")[0];else var h=$("#"+this.options.id+"_content_table")[0];var u=h.insertRow(this.eidtRowIndex+2);u.id=this.options.id+"_edit_tr";var c=u.insertCell();c.id=this.options.id+"_edit_td",c.style.borderBottom="0px";var p=parseInt(this.contentMinWidth)+parseInt(this.fixedWidth),m='<div id="'+this.options.id+'_edit_form" class="u-grid-edit-form" style="width:'+p+'px;float:left;">';if($.each(this.gridCompColumnFixedArr,function(t){var i=!1;if(this.options.editFormShow&&(this.options.editable||!this.options.editable&&e.options.noneEditableFormShow)&&(i=!0),i){var o=this.options.field,s=$(n).attr(o);s=e.getString(s,"");var d=this.options.title;m+=e.formEditCell(s,o,d,this.options.required)}}),$.each(this.gridCompColumnArr,function(t){var i=!1;if(this.options.editFormShow&&(this.options.editable||!this.options.editable&&e.options.noneEditableFormShow)&&(i=!0),i){var o=this.options.field,s=$(n).attr(o);s=e.getString(s,"");var d=this.options.title;m+=e.formEditCell(s,o,d,this.options.required)}}),m+="</div>",c.innerHTML=m,$.each(this.gridCompColumnFixedArr,function(t){var i=!1;if(this.options.editFormShow&&(this.options.editable||!this.options.editable&&e.options.noneEditableFormShow)&&(i=!0),i){var o=this.options.field,s=$("#"+e.options.id+"_edit_"+o)[0],d=$(n).attr(o);this.options.title;d=e.getString(d,""),m+=e.editCell(s,d,o,this.options.editType,e.editRowObj)}}),$.each(this.gridCompColumnArr,function(t){var i=!1;if(this.options.editFormShow&&(this.options.editable||!this.options.editable&&e.options.noneEditableFormShow)&&(i=!0),i){var o=this.options.field,s=$("#"+e.options.id+"_edit_"+o)[0],d=$(n).attr(o);this.options.title;d=e.getString(d,""),m+=e.editCell(s,d,o,this.options.editType,e.editRowObj)}}),"function"==typeof this.options.renderEditMemu)this.options.renderEditMemu.apply(this,[$("#"+this.options.id+"_edit_form")[0],this.eidtRowIndex,this.dataSourceObj.rows.length]);else{var m='<div id="'+this.options.id+'_content_edit_menu" style="position:relative;float:left;width:100%;height:40px;"><button type="button" class="u-grid-content-edit-menu-button u-grid-content-edit-menu-button-ok" id="'+this.options.id+'_content_edit_menu_close">'+this.transMap.ml_close+"</button></div>";$("#"+this.options.id+"_edit_form")[0].insertAdjacentHTML("beforeEnd",m),$("#"+this.options.id+"_content_edit_menu_close").on("click",function(t){e.editClose()})}var v=$("#"+this.options.id+"_edit_td")[0].offsetHeight,w=$("#"+this.options.id+"_edit_form").css("background-color");if(this.options.multiSelect){var g=$("#"+this.options.id+"_content_multiSelect > div").eq(this.eidtRowIndex),m='<div class="grid_open_edit " id="'+this.options.id+'_multiSelect_edit" style="background-color:'+w+";float:left;position:relative;width:"+this.multiSelectWidth+"px;height:"+v+'px"></div>';g[0].insertAdjacentHTML("afterEnd",m)}if(this.options.showNumCol){var g=$("#"+this.options.id+"_content_numCol > .u-grid-content-num").eq(this.eidtRowIndex),m='<div id="'+this.options.id+'_numCol_edit" style="background-color:'+w+";float:left;position:relative;width:"+this.numWidth+'px;"></div>';g[0].insertAdjacentHTML("afterEnd",m)}if($("#"+this.options.id+"_content_edit_menu").css("display","block"),this.fixedWidth>0){var _=$("#"+this.options.id+"_content_table")[0],C=_.insertRow(this.eidtRowIndex+2);C.id=this.options.id+"_edit_tr1"}}},editClose:function(){var t=this.dataSourceObj.rows[this.eidtRowIndex];t&&("form"!=this.options.editType&&this.repaintRow(this.eidtRowIndex),$("#"+this.options.id+"_content_edit_menu").css("display","none"),this.repairSumRow(),this.noRowsShowFun(),this.updateLastRowFlag(),this.eidtRowIndex=-1,"form"==this.options.editType&&($("#"+this.options.id+"_multiSelect_edit").remove(null,!0),$("#"+this.options.id+"_numCol_edit").remove(null,!0),$("#"+this.options.id+"_edit_tr").remove(null,!0),$("#"+this.options.id+"_edit_tr1").remove(null,!0)))},editCell:function(t,i,e,o,n){var s=this;if("text"==o)"default"==this.options.editType?t.innerHTML='<input id="'+this.options.id+"_edit_field_"+e+'" type="text" value="'+i+'" field="'+e+'" style="width:100%;margin:0px;min-height:20px;font-size:12px;color:#444">':t.innerHTML='<input id="'+this.options.id+"_edit_field_"+e+'" type="text" value="'+i+'" field="'+e+'">',$("input",$(t)).on("blur",function(){s.editValueChange(e,this.value)});else if("function"==typeof o){var d={};d.gridObj=this,d.element=t,d.value=i,d.field=e,d.rowObj=n,o.call(this,d)}"default"==this.options.editType&&$("input",$(t)).focus()},editValueChange:function(t,i){this.updateValueAt(this.eidtRowIndex,t,i)},formEditCell:function(t,i,e,o){var n=e+"";n.lengthb()>28&&(n=n.substrCH(26)+"...");var s='<div class="u-grid-edit-whole-div"><div class="u-grid-edit-label"><div title="'+e+'">'+n+'<span style="color:red;'+(o?"":"display: none")+'" class="u-grid-edit-mustFlag">*</span></div></div>';return s+='<div id="'+this.options.id+"_edit_"+i+'" class="u-grid-edit-div"></div>',s+="</div>"},getLocalData:function(){return null;var t},saveLocalData:function(){return null},clearLocalData:function(){return null},saveGridCompColumnArrToLocal:function(){return null},getGridCompColumnArrFromLocal:function(){return null},formatWidth:function(t){return t?(t+"").indexOf("%")>0?t:parseInt(t)+"px":""},swapEle:function(t,i){var e=t.next(),o=i.prev();i.insertBefore(e),t.insertAfter(o)},getString:function(t,i){return(null===t||t===undefined||"null"===t||"undefined"===t||""===t)&&(t=i),iweb.browser.isIE8?[t].join(""):t+""},getInt:function(t,i){return(null===t||t===undefined||"null"===t||"undefined"===t||""===t||Number.isNaN(t))&&(t=i),t},getFloat:function(t,i){return(null===t||t===undefined||"null"===t||"undefined"===t||""===t||Number.isNaN(t))&&(t=i),t},cloneObj:function(t){var i;if("object"==typeof t)if(null===t)i=null;else if(t instanceof Array){i=[];for(var e=0,o=t.length;o>e;e++)i.push(this.cloneObj(t[e]))}else{i={};for(var n in t)i[n]=this.cloneObj(t[n])}else i=t;return i},DicimalFormater:function(t){for(var i=t.value+"",e=t.precision,o=0;o<i.length;o++)if(-1=="-0123456789.".indexOf(i.charAt(o)))return"";return this.checkDicimalInvalid(i,e)},checkDicimalInvalid:function(t,i){if(null==t||isNaN(t))return"";var e=parseFloat(t),o=(e*Math.pow(10,i)/Math.pow(10,i)).toFixed(i);return"NaN"==o?"":o},accAdd:function(t,i){var e,o,n;try{e=t.toString().split(".")[1].length}catch(s){e=0}try{o=i.toString().split(".")[1].length}catch(s){o=0}return n=Math.pow(10,Math.max(e,o)),(t*n+i*n)/n},getTrIndex:function(t){return $('tr[id!="'+this.options.id+'_edit_tr"]',t.parent()).index(t)},setDataSource:function(t){this.initDataSourceVariable(),this.options.dataSource=t,this.initDataSource(),this.repairContent(),this.afterGridDivsCreate()},setDataSourceFun1:function(t){var i={};if(t.values){var e=new Array;$.each(t.values,function(){if(t.fields){var i={},o=this;$.each(t.fields,function(t){$(i).attr(this,o[t])}),e.push(i)}})}$(i).attr("values",e),this.setDataSource(i)},addOneRow:function(t,i){var e=this,o="none",n={};n.value=t;var s,d=0,r=this.dataSourceObj.rows.length,a=!1;if("grid"==this.showType){if(-1!=this.eidtRowIndex&&this.editClose(),this.options.showTree){var l=!1,h=!1,u=this.options.keyField,c=this.options.parentKeyField,p=this.getString($(t).attr(u),""),m=this.getString($(t).attr(c),"");$.each(this.dataSourceObj.rows,function(t){var o=this.value,r=e.getString($(o).attr(u),""),a=e.getString($(o).attr(c),"");
if(r==m){l=!0,s=t,d=this.childRowIndex.length;var f=this.level;n.level=f+1,i=s+1,this.allChildRowIndex=new Array}a==p&&(h=!0)}),l||(n.level=0,i!=r&&(i=0))}if(0!=i&&(i&&i>0?i>r&&(i=r):i=0),r==i&&(a=!0),n.valueIndex=i,this.dataSourceObj.rows.splice(i,0,n),this.updateEditRowIndex("+",i),this.dataSourceObj.rows.length>i+1&&$.each(this.dataSourceObj.rows,function(t){t>i&&(this.valueIndex=this.valueIndex+1)}),l){var f=$("#"+this.options.id+"_content_div").find("tbody").find('tr[role="row"]').eq(s);if(d>0){var v=$(".fa-plus-square-o",f);v.length>0||(o="block")}else{o="block";var w=$("div:visible:eq(0)",f),v=$(".fa-plus-square-o",f),g=$(".fa-minus-square-o",f),_='<span class="fa u-grid-content-tree-span fa-minus-square-o"></span>';if(w.length>0&&0==v.length&&0==g.length){w[0].insertAdjacentHTML("afterBegin",_);var C=parseInt(w[0].style.left);r=C-16,(r>0||0==r)&&(w[0].style.left=r+"px")}v.length>0&&v.removeClass("fa-plus-square-o").addClass("fa-minus-square-o")}}try{var b=this.createContentOneRow(n,"normal",o);a?$("#"+this.options.id+"_content_div tbody")[0].insertAdjacentHTML("beforeEnd",b):$("#"+this.options.id+"_content_div").find("tbody").find('tr[role="row"]')[i]?$("#"+this.options.id+"_content_div").find("tbody").find('tr[role="row"]')[i].insertAdjacentHTML("beforeBegin",b):$("#"+this.options.id+"_content_div tbody")[0]&&$("#"+this.options.id+"_content_div tbody")[0].insertAdjacentHTML("afterBegin",b);var b=this.createContentOneRow(n,"fixed",o);a?$("#"+this.options.id+"_content_fixed_div tbody")[0].insertAdjacentHTML("beforeEnd",b):$("#"+this.options.id+"_content_fixed_div").find("tbody").find('tr[role="row"]')[i]?$("#"+this.options.id+"_content_fixed_div").find("tbody").find('tr[role="row"]')[i].insertAdjacentHTML("beforeBegin",b):$("#"+this.options.id+"_content_fixed_div tbody")[0]&&$("#"+this.options.id+"_content_fixed_div tbody")[0].insertAdjacentHTML("afterBegin",b)}catch(y){var T=$("#"+this.options.id+"_content_div table")[0];T&&this.createContentOneRowForIE(T,i,n,"normal",o);var x=$("#"+this.options.id+"_content_fixed_div table")[0];x&&this.createContentOneRowForIE(x,i,n,"fixed",o)}if(this.options.multiSelect){var b=this.createContentLeftMultiSelectRow(n,o);a?$("#"+this.options.id+"_content_multiSelect")[0].insertAdjacentHTML("beforeEnd",b):$("#"+this.options.id+"_content_multiSelect").find("div")[i]?$("#"+this.options.id+"_content_multiSelect").find("div")[i].insertAdjacentHTML("beforeBegin",b):$("#"+this.options.id+"_content_multiSelect")[0].insertAdjacentHTML("afterBegin",b)}if(this.options.showNumCol){var b=this.createContentLeftNumColRow(r);a?$("#"+this.options.id+"_content_numCol")[0].insertAdjacentHTML("beforeEnd",b):$("#"+this.options.id+"_content_numCol").find("div")[i]?$("#"+this.options.id+"_content_numCol").find("div")[i].insertAdjacentHTML("beforeBegin",b):$("#"+this.options.id+"_content_numCol")[0].insertAdjacentHTML("afterBegin",b),this.resetNumCol(),this.updateNumColLastRowFlag()}this.repairSumRow(),this.noRowsShowFun(),this.updateLastRowFlag();var R={};R.begin=i,R.length=1,this.renderTypeFun(R)}var r=0;this.options.showTree?(this.dataSourceObj.options.values?r=this.dataSourceObj.options.values.length:this.dataSourceObj.options.values=new Array,this.dataSourceObj.options.values.splice(i,0,t),this.dataSourceObj.sortRows(),h&&this.repairContent()):(this.dataSourceObj.options.values||(this.dataSourceObj.options.values=new Array),this.dataSourceObj.options.values.splice(i,0,t))},addRows:function(t,i){if(this.options.showTree)for(var e=t.length,o=e-1;o>-1;o--)this.addOneRow(t[o],i);else{-1!=this.eidtRowIndex&&this.editClose();var n="",s="",d="",r="",a=this,e=this.dataSourceObj.rows.length,l=!1;0!=i&&(i&&i>0?i>e&&(i=e):i=0),e==i&&(l=!0);var h=new Array;if($.each(t,function(t){var e={};e.value=this,e.valueIndex=i+t,h.push(e),a.dataSourceObj.rows.splice(i+t,0,e),a.updateEditRowIndex("+",i+t)}),this.dataSourceObj.rows.length>i+t.length&&$.each(this.dataSourceObj.rows,function(e){e>i+t.length-1&&(this.valueIndex=this.valueIndex+t.length)}),"grid"==this.showType&&$("#"+this.options.id+"_content_div tbody")[0]){$.each(h,function(t){n+=a.createContentOneRow(this),r+=a.createContentOneRow(this,"fixed"),a.options.multiSelect&&(s+=a.createContentLeftMultiSelectRow(this)),a.options.showNumCol&&(d+=a.createContentLeftNumColRow(e+t))});try{l?$("#"+this.options.id+"_content_div tbody")[0].insertAdjacentHTML("beforeEnd",n):$("#"+this.options.id+"_content_div").find("tbody").find('tr[role="row"]')[i]?$("#"+this.options.id+"_content_div").find("tbody").find('tr[role="row"]')[i].insertAdjacentHTML("beforeBegin",n):$("#"+this.options.id+"_content_div tbody")[0]&&$("#"+this.options.id+"_content_div tbody")[0].insertAdjacentHTML("afterBegin",n),l?$("#"+this.options.id+"_content_fixed_div tbody")[0].insertAdjacentHTML("beforeEnd",r):$("#"+this.options.id+"_content_fixed_div").find("tbody").find('tr[role="row"]')[i]?$("#"+this.options.id+"_content_fixed_div").find("tbody").find('tr[role="row"]')[i].insertAdjacentHTML("beforeBegin",r):$("#"+this.options.id+"_content_fixed_div tbody")[0]&&$("#"+this.options.id+"_content_fixed_div tbody")[0].insertAdjacentHTML("afterBegin",r)}catch(u){var c=$("#"+this.options.id+"_content_div table")[0],p=$("#"+this.options.id+"_content_fixed_div table")[0];c&&p&&$.each(h,function(t){a.createContentOneRowForIE(c,i+t,this),a.createContentOneRowForIE(p,i+t,this,"fixed")})}if(this.options.multiSelect)if(l)$("#"+this.options.id+"_content_multiSelect")[0].insertAdjacentHTML("beforeEnd",s);else{var m=$("#"+this.options.id+"_content_multiSelect").find("div")[i];m?m.insertAdjacentHTML("beforeBegin",s):$("#"+this.options.id+"_content_multiSelect")[0].insertAdjacentHTML("afterBegin",s)}if(this.options.showNumCol){if(l)$("#"+this.options.id+"_content_numCol")[0].insertAdjacentHTML("beforeEnd",d);else{var m=$("#"+this.options.id+"_content_numCol").find("div")[i];m?m.insertAdjacentHTML("beforeBegin",d):$("#"+this.options.id+"_content_numCol")[0].insertAdjacentHTML("afterBegin",d)}this.resetNumCol(),this.updateNumColLastRowFlag()}this.repairSumRow(),this.noRowsShowFun();var f={};f.begin=i,f.length=t.length,this.renderTypeFun(f)}this.dataSourceObj.options.values||(this.dataSourceObj.options.values=new Array),$.each(t,function(t){a.dataSourceObj.options.values.splice(i+t,0,this)}),this.updateLastRowFlag()}},updateEditRowIndex:function(t,i,e){this.eidtRowIndex<0||("-"==t?i<this.eidtRowIndex?this.eidtRowIndex--:i==this.eidtRowIndex&&(this.eidtRowIndex=-1):"+"==t&&(e===undefined&&(e=1),i<=this.eidtRowIndex&&(this.eidtRowIndex+=e)))},deleteOneRow:function(t){var i=this;t=parseInt(t);var e=this.dataSourceObj.rows[t];if(e){var o=e.value;if("grid"==this.showType&&-1!=this.eidtRowIndex&&this.editClose(),this.dataSourceObj.rows.splice(t,1),this.updateEditRowIndex("-",t),this.selectRows&&$.each(this.selectRows,function(e){this==o?(i.selectRows.splice(e,1),i.selectRowsObj.splice(e,1),i.selectRowsIndex.splice(e,1)):i.selectRowsIndex[e]>t&&(i.selectRowsIndex[e]=i.selectRowsIndex[e]-1)}),this.focusRow&&(this.focusRow==o?(this.focusRow=null,this.focusRowObj=null,this.focusRowIndex=null):this.focusRowIndex>t&&(this.focusRowIndex=this.focusRowIndex-1)),"grid"==this.showType&&($("#"+this.options.id+"_content_div tbody tr:eq("+t+")").remove(),$("#"+this.options.id+"_content_fixed_div tbody tr:eq("+t+")").remove(),$("#"+this.options.id+"_content_multiSelect >div:eq("+t+")").remove(),$("#"+this.options.id+"_content_numCol >.u-grid-content-num:eq("+t+")").remove(),this.resetNumCol(),this.repairSumRow(),this.noRowsShowFun(),this.updateNumColLastRowFlag()),this.dataSourceObj.options.values){var n=this.dataSourceObj.options.values.indexOf(o);this.dataSourceObj.options.values.splice(n,1)}if(this.options.showTree&&this.dataSourceObj.sortRows(),"function"==typeof this.options.onRowDelete){var s={};if(s.gridObj=this,s.index=t,!this.options.onRowDelete(t))return}}},deleteRows:function(t){var i=this,e=new Array;$.each(t,function(i){e.push(t[i])}),e.sort(function(t,i){return i-t}),$.each(e,function(t){i.deleteOneRow(this)})},updateRow:function(t,i){if(this.dataSourceObj.rows[t].value=i,this.dataSourceObj.options.values[this.dataSourceObj.rows[t].valueIndex]=i,"grid"==this.showType){var e={};e.begin=t,e.length=1,this.renderTypeFun(e),this.repairSumRow()}},updateValueAt:function(t,i,e,o){var n=$(this.dataSourceObj.rows[t].value).attr(i);if(n!=e||o){if($(this.dataSourceObj.rows[t].value).attr(i,e),$(this.dataSourceObj.options.values[this.dataSourceObj.rows[t].valueIndex]).attr(i,e),"grid"==this.showType){var s={};s.field=i,s.begin=t,s.length=1,this.renderTypeFun(s),this.editColIndex=undefined,this.eidtRowIndex==t&&$("#"+this.options.id+"_edit_field_"+i).length>0&&("checkbox"==$("#"+this.options.id+"_edit_field_"+i)[0].type?"Y"==e||"true"==e?$("#"+this.options.id+"_edit_field_"+i)[0].checked=!0:$("#"+this.options.id+"_edit_field_"+i)[0].checked=!1:$("#"+this.options.id+"_edit_field_"+i)[0].value=e),this.repairSumRow()}if("function"==typeof this.options.onValueChange){var s={};s.gridObj=this,s.rowIndex=t,s.field=i,s.oldValue=n,s.newValue=e,this.options.onValueChange(s)}}},setRowSelect:function(t,i){var e,o,n,s;if(!this.dataSourceObj.rows[t])return!0;if(this.dataSourceObj.rows[t].checked)return!0;if(e=i&&i.multiSelectDivs?i.multiSelectDivs[t]:this.$ele.find("#"+this.options.id+"_content_multiSelect").children()[t],"function"==typeof this.options.onBeforeRowSelected){var d={};if(d.gridObj=this,d.rowObj=this.dataSourceObj.rows[t],d.rowIndex=t,!this.options.onBeforeRowSelected(d)){if(this.options.multiSelect){var r=e.children[0];r.checked=!1}return!1}}if(this.options.multiSelect){if("grid"==this.showType){var r=e.children[0];r.checked=!0}}else this.selectRowsObj&&this.selectRowsObj.length>0&&$.each(this.selectRowsObj,function(){this.checked=!1}),this.selectRows=new Array,this.selectRowsObj=new Array,this.selectRowsIndex=new Array,"grid"==this.showType&&($("#"+this.options.id+"_content_tbody tr").removeClass("u-grid-content-sel-row"),$("#"+this.options.id+"_content_tbody tr a").removeClass("u-grid-content-sel-row"),$("#"+this.options.id+"_content_fixed_tbody tr").removeClass("u-grid-content-sel-row"),$("#"+this.options.id+"_content_fixed_tbody tr a").removeClass("u-grid-content-sel-row"),this.options.multiSelect&&$("#"+this.options.id+"_content_multiSelect div").removeClass("u-grid-content-sel-row"),this.options.showNumCol&&$("#"+this.options.id+"_content_numCol div").removeClass("u-grid-content-sel-row"));if("grid"==this.showType){o=i&&i.contentTrs?i.contentTrs[t]:this.$ele.find("#"+this.options.id+'_content_tbody tr[role="row"]')[t],$(o).addClass("u-grid-content-sel-row"),n=i&&i.fixContentTrs?i.fixContentTrs[t]:this.$ele.find("#"+this.options.id+'_content_fixed_tbody tr[role="row"]')[t],$(n).addClass("u-grid-content-sel-row");var a=t;this.eidtRowIndex>-1&&this.eidtRowIndex<t&&"form"==this.options.editType&&a++,this.options.multiSelect&&(a!=t&&(e=this.$ele.find("#"+this.options.id+"_content_multiSelect").children()[a]),$(e).addClass("u-grid-content-sel-row")),this.options.showNumCol&&(s=i&&i.numColDivs?i.numColDivs[a]:this.$ele.find("#"+this.options.id+"_content_numCol").children()[a],$(s).addClass("u-grid-content-sel-row"))}if(this.selectRows.push(this.dataSourceObj.rows[t].value),this.selectRowsObj.push(this.dataSourceObj.rows[t]),this.selectRowsIndex.push(t),this.dataSourceObj.rows[t].checked=!0,"function"==typeof this.options.onRowSelected){var d={};d.gridObj=this,d.rowObj=this.dataSourceObj.rows[t],d.rowIndex=t,this.options.onRowSelected(d)}return!0},setRowUnselect:function(t){var i=this;if(!this.dataSourceObj.rows[t])return!0;if(!this.dataSourceObj.rows[t].checked)return!0;if("function"==typeof this.options.onBeforeRowUnSelected){var e={};if(e.gridObj=this,e.rowObj=this.dataSourceObj.rows[t],e.rowIndex=t,!this.options.onBeforeRowUnSelected(e))return this.options.multiSelect&&($("#"+this.options.id+"_content_multiSelect input:eq("+t+")")[0].checked=!0),!1}this.options.multiSelect&&($("#"+this.options.id+"_content_multiSelect input:eq("+t+")")[0].checked=!1);var o=t;if(this.eidtRowIndex>-1&&this.eidtRowIndex<t&&"form"==this.options.editType&&o++,$("#"+this.options.id+"_content_tbody tr:eq("+o+")").removeClass("u-grid-content-sel-row"),$("#"+this.options.id+"_content_tbody tr:eq("+o+") a").removeClass("u-grid-content-sel-row"),$("#"+this.options.id+"_content_fixed_tbody tr:eq("+o+")").removeClass("u-grid-content-sel-row"),$("#"+this.options.id+"_content_fixed_tbody tr:eq("+o+") a").removeClass("u-grid-content-sel-row"),this.options.multiSelect&&$("#"+this.options.id+"_content_multiSelect >div:eq("+o+")").removeClass("u-grid-content-sel-row"),this.options.showNumCol&&$("#"+this.options.id+"_content_numCol >div:eq("+o+")").removeClass("u-grid-content-sel-row"),$.each(this.selectRows,function(e){this==i.dataSourceObj.rows[t].value&&(i.selectRows.splice(e,1),i.selectRowsObj.splice(e,1),i.selectRowsIndex.splice(e,1))}),this.dataSourceObj.rows[t].checked=!1,"function"==typeof this.options.onRowUnSelected){var e={};e.gridObj=this,e.rowObj=this.dataSourceObj.rows[t],e.rowIndex=t,this.options.onRowUnSelected(e)}return!0},setAllRowSelect:function(){if($("#"+this.options.id+"_header_multi_input").prop("checked",!0),"function"==typeof this.options.onBeforeAllRowSelected){var t={};if(t.gridObj=this,t.rowObjs=this.dataSourceObj.rows,!this.options.onBeforeAllRowSelected(t))return}var i=this.$ele.find("#"+this.options.id+"_content_multiSelect").children(),e=this.$ele.find("#"+this.options.id+"_content_numCol").children(),o=this.$ele.find("#"+this.options.id+'_content_tbody tr[role="row"]'),n=this.$ele.find("#"+this.options.id+'_content_fixed_tbody tr[role="row"]');this.$ele.find("#"+this.options.id+'_content_tbody tr[role="row"]');for(var s=0;s<this.dataSourceObj.rows.length;s++)this.setRowSelect(s,{multiSelectDivs:i,numColDivs:e,contentTrs:o,fixContentTrs:n});if("function"==typeof this.options.onAllRowSelected){var t={};t.gridObj=this,t.rowObjs=this.dataSourceObj.rows,this.options.onAllRowSelected(t)}},setAllRowUnSelect:function(){if($("#"+this.options.id+"_header_multi_input").attr("checked",!1),"function"==typeof this.options.onBeforeAllRowUnSelected){var t={};if(t.gridObj=this,t.rowObjs=this.dataSourceObj.rows,!this.options.onBeforeAllRowUnSelected(t))return}for(var i=0;i<this.dataSourceObj.rows.length;i++)this.setRowUnselect(i);if("function"==typeof this.options.onAllRowUnSelected){var t={};t.gridObj=this,t.rowObjs=this.dataSourceObj.rows,this.options.onAllRowUnSelected(t)}},getSelectRows:function(){return this.selectRows},getSelectRowsIndex:function(){return this.selectRowsIndex},setRowFocus:function(t){if(this.dataSourceObj.rows[t].focus)return!0;if(!this.dataSourceObj.rows[t])return!0;if("function"==typeof this.options.onBeforeRowFocus){var i={};if(i.gridObj=this,i.rowObj=this.dataSourceObj.rows[t],i.rowIndex=t,!this.options.onBeforeRowFocus(i))return!1}$("#"+this.options.id+"_content_tbody tr").removeClass("u-grid-content-focus-row"),$("#"+this.options.id+"_content_tbody tr a").removeClass("u-grid-content-focus-row"),$("#"+this.options.id+"_content_fixed_tbody tr").removeClass("u-grid-content-focus-row"),$("#"+this.options.id+"_content_fixed_tbody tr a").removeClass("u-grid-content-focus-row"),this.options.multiSelect&&$("#"+this.options.id+"_content_multiSelect").find("div").removeClass("u-grid-content-focus-row"),this.options.showNumCol&&$("#"+this.options.id+"_content_numCol").find("div").removeClass("u-grid-content-focus-row"),this.focusRowObj&&(this.focusRowObj.focus=!1),$("#"+this.options.id+'_content_tbody tr[role="row"]:eq('+t+")").addClass("u-grid-content-focus-row"),$("#"+this.options.id+'_content_tbody tr[role="row"]:eq('+t+") a").addClass("u-grid-content-focus-row"),$("#"+this.options.id+'_content_fixed_tbody tr[role="row"]:eq('+t+")").addClass("u-grid-content-focus-row"),$("#"+this.options.id+'_content_fixed_tbody tr[role="row"]:eq('+t+") a").addClass("u-grid-content-focus-row");var e=t;if(this.eidtRowIndex>-1&&this.eidtRowIndex<t&&"form"==this.options.editType&&e++,this.options.multiSelect&&$("#"+this.options.id+"_content_multiSelect >div:eq("+e+")").addClass("u-grid-content-focus-row"),this.options.showNumCol&&$("#"+this.options.id+"_content_numCol >div:eq("+e+")").addClass("u-grid-content-focus-row"),this.focusRow=this.dataSourceObj.rows[t].value,this.focusRowObj=this.dataSourceObj.rows[t],this.focusRowIndex=t,this.dataSourceObj.rows[t].focus=!0,"function"==typeof this.options.onRowFocus){var i={};i.gridObj=this,i.rowObj=this.dataSourceObj.rows[t],i.rowIndex=t,this.options.onRowFocus(i)}return this.options.multiSelect||this.setRowSelect(t),!0},setRowUnFocus:function(t){if(!this.dataSourceObj.rows[t])return!0;if("function"==typeof this.options.onBeforeRowUnFocus){var i={};if(i.gridObj=this,i.rowObj=this.dataSourceObj.rows[t],i.rowIndex=t,!this.options.onBeforeRowUnFocus(i))return!1}if(!this.dataSourceObj.rows[t].focus)return!0;var e=t;if(this.eidtRowIndex>-1&&this.eidtRowIndex<t&&"form"==this.options.editType&&e++,$("#"+this.options.id+"_content_tbody tr:eq("+e+")").removeClass("u-grid-content-focus-row"),$("#"+this.options.id+"_content_tbody tr:eq("+e+") a").removeClass("u-grid-content-focus-row"),$("#"+this.options.id+"_content_fixed_tbody tr:eq("+e+")").removeClass("u-grid-content-focus-row"),$("#"+this.options.id+"_content_fixed_tbody tr:eq("+e+") a").removeClass("u-grid-content-focus-row"),this.options.multiSelect&&$("#"+this.options.id+"_content_multiSelect >div:eq("+e+")").removeClass("u-grid-content-focus-row"),this.options.showNumCol&&$("#"+this.options.id+"_content_numCol >div:eq("+e+")").removeClass("u-grid-content-focus-row"),this.dataSourceObj.rows[t].focus=!1,this.focusRow=null,this.focusRowObj=null,this.focusRowIndex=null,"function"==typeof this.options.onRowUnFocus){var i={};i.gridObj=this,i.rowObj=this.dataSourceObj.rows[t],i.rowIndex=t,this.options.onRowUnFocus(i)}return this.options.multiSelect||this.setRowUnselect(t),!0},resetNumCol:function(){var t=$("#"+this.options.id+"_content_numCol >.u-grid-content-num");$.each(t,function(t){this.innerHTML=t+1+""})},getFocusRow:function(){return this.focusRow},getFocusRowIndex:function(){return this.focusRowIndex},getAllRows:function(){var t=this;return this.allRows=new Array,this.dataSourceObj.rows&&$.each(this.dataSourceObj.rows,function(){t.allRows.push(this.value)}),this.allRows},getRowByIndex:function(t){return this.dataSourceObj.rows[t]},getRowIndexByValue:function(t,i){var e=-1;return $.each(this.dataSourceObj.rows,function(o){var n=$(this.value).attr(t);n==i&&(e=o)}),e},getAllChildRow:function(t){return t.allChildRow&&t.allChildRow.length>0?t.allChildRow:(t.allChildRow=new Array,this.getAllChildRowFun(t,t.allChildRow),t.allChildRow)},getAllChildRowIndex:function(t){return t.allChildRowIndex&&t.allChildRowIndex.length>0?t.allChildRowIndex:(t.allChildRowIndex=new Array,this.getAllChildRowIndexFun(t,t.allChildRowIndex),t.allChildRowIndex)},getAllChildRowFun:function(t,i){var e=this;t.childRow.length>0&&(Array.prototype.push.apply(i,t.childRow),$.each(t.childRow,function(){e.getAllChildRowFun(this,i)}))},getAllChildRowIndexFun:function(t,i){var e=this;t.childRowIndex.length>0&&(Array.prototype.push.apply(i,t.childRowIndex),$.each(t.childRow,function(){e.getAllChildRowIndexFun(this,i)}))},setRenderType:function(t,i){var e=this.getColumnByField(t);e.options.renderType=i;var o=this.getIndexOfColumn(e);this.renderTypeByColumn(e,o)},setEditType:function(t,i){var e=this.getColumnByField(t);e.options.editType=i},setEditable:function(t){this.options.editable=t},setShowHeader:function(t){this.options.showHeader=t,t?$("#"+this.options.id+"_header").css("display","block"):$("#"+this.options.id+"_header").css("display","none")},setColumnPrecision:function(t,i){var e=this.getColumnByField(t);e.options.precision=i,this.renderTypeFun(),this.options.showSumRow&&this.repairSumRow()},setMultiSelect:function(t){var i=this.options.multiSelect;i!=t&&(this.options.multiSelect=t,this.initGrid())},setShowNumCol:function(t){var i=this.options.showNumCol;i!=t&&(this.options.showNumCol=t,this.initGrid())}},dataSource.prototype={sortRows:function(t,i){this.gridComp.options.showTree?this.treeSortRows(t,i):this.basicSortRows(t,i),this.gridComp.eidtRowIndex=-1},sortRowsByPrio:function(prioArray,cancelSort){var oThis=this;cancelSort&&(this.rows=new Array,this.options.values&&$.each(this.options.values,function(t){var i={};i.value=this,i.valueIndex=t,oThis.rows.push(i)}));var evalStr=function(t){return t==prioArray.length-1?"by(prioArray["+t+"].field, prioArray["+t+"].sortType)":"by(prioArray["+t+"].field, prioArray["+t+"].sortType,"+evalStr(t+1)+")"},by=function(t,i,e){arguments.callee;return function(o,n){var s=$(o.value).attr(t),d=$(n.value).attr(t),r=oThis.gridComp.getColumnByField(t).options.dataType;if("Float"==r)return s=parseFloat(s),d=parseFloat(d),isNaN(s)?1:isNaN(d)?-1:s==d&&e?e():"asc"==i?s-d:d-s;if("Int"==r)return s=parseInt(s),d=parseInt(d),isNaN(s)?1:isNaN(d)?-1:s==d&&e?e():"asc"==i?s-d:d-s;s=oThis.gridComp.getString(s,""),d=oThis.gridComp.getString(d,"");try{var a=s.localeCompare(d);return 0===a&&e?e():0===a?0:"asc"==i?a:-a}catch(l){return 0}}};this.rows.sort(eval(evalStr(0)))},basicSortRows:function(t,i){var e=this,o="";t&&(o=this.gridComp.getColumnByField(t).options.dataType),"asc"==i?this.rows.sort(function(i,n){var s=$(n.value).attr(t),d=$(i.value).attr(t);if("Float"==o)return s=parseFloat(s),d=parseFloat(d),isNaN(s)?1:isNaN(d)?-1:s-d;if("Int"==o)return s=parseInt(s),d=parseInt(d),isNaN(s)?1:isNaN(d)?-1:s-d;s=e.gridComp.getString(s,""),d=e.gridComp.getString(d,"");try{return s.localeCompare(d)}catch(r){return 0}}):"desc"==i?this.rows.sort(function(i,n){var s=$(i.value).attr(t),d=$(n.value).attr(t);if("Float"==o)return s=parseFloat(s),d=parseFloat(d),isNaN(s)?1:isNaN(d)?-1:s-d;if("Int"==o)return s=parseInt(s),d=parseInt(d),isNaN(s)?1:isNaN(d)?-1:s-d;s=e.gridComp.getString(s,""),d=e.gridComp.getString(d,"");try{return s.localeCompare(d)}catch(r){return 0}}):(this.rows=new Array,this.options.values&&$.each(this.options.values,function(t){var i={};i.value=this,i.valueIndex=t,e.rows.push(i)}))},treeSortRows:function(t,i){var e=this;if(this.rows=new Array,this.hasParentRows=new Array,this.nothasParentRows=new Array,this.options.values){$.each(this.options.values,function(t){var i={},o=$(this),n=e.gridComp.options.keyField,s=e.gridComp.options.parentKeyField,d=e.gridComp.getString(o.attr(n),""),r=e.gridComp.getString(o.attr(s),"");i.valueIndex=t,i.value=this,i.keyValue=d,i.parentKeyValue=r,""==r?e.nothasParentRows.push(i):e.hasParentRows.push(i),e.rows.push(i)}),$.each(this.hasParentRows,function(t){var i=this.parentKeyValue,o=!1;$.each(e.rows,function(){this.keyValue==i&&(o=!0)}),o||(e.hasParentRows.splice(t,0),e.nothasParentRows.push(this))}),e.rows=new Array;var o=0;$.each(this.nothasParentRows,function(t){this.level=o,e.rows.push(this),e.pushChildRows(this,o)})}},pushChildRows:function(t,i){var e=t.keyValue,o=this,n=parseInt(i)+1,s=!1,d=new Array,r=new Array;$.each(this.hasParentRows,function(t){if(this&&this.parentKeyValue==e){s=!0,this.level=n,o.rows.push(this),d.push(this);var i=parseInt(o.rows.length-1);r.push(i),o.hasParentRows.splice(t,0),o.pushChildRows(this,n)}}),t.hasChild=s,t.childRow=d,t.childRowIndex=r},getSumValue:function(t,i,e){var o=null;if(i.options.sumCol&&$.each(this.rows,function(n){var s=$(this.value).attr(t);"Int"==i.options.dataType?(s=e.getInt(s,0),o+=parseInt(s)):(s=e.getFloat(s,0),o=e.accAdd(o,parseFloat(s)))}),"Float"==i.options.dataType&&i.options.precision){var n={};n.value=o,n.precision=i.options.precision,o=e.DicimalFormater(n)}return null!=o&&o!=undefined&&"null"!=o&&"undefined"!=o?o+"":""}};var old=$.fn.grid;$.fn.grid=function(t){var i=$(this).data("gridComp");return i||$(this).data("gridComp",i=new gridComp(this,t)),i},$.fn.grid.noConflict=function(){return $.fn.grid=old,this}}(jQuery,window,document),+function($){var Grid=function(options){var opt=options.options||{},viewModel=options.model,element="string"==typeof options.el?document.querySelector(options.el):options.el,app=options.app;this.id=opt.id,options=opt;var oThis=this,compDiv=null,comp=null;this.dataTable=u.getJSObject(viewModel,options.data),this.element=element,this.$element=$(element),this.editComponentDiv={},this.editComponent={},this.id=options.id,this.gridOptions=options,this.gridOptions.onBeforeRowSelected=u.getFunction(viewModel,this.gridOptions.onBeforeRowSelected),this.gridOptions.onRowSelected=u.getFunction(viewModel,this.gridOptions.onRowSelected),this.gridOptions.onBeforeRowUnSelected=u.getFunction(viewModel,this.gridOptions.onBeforeRowUnSelected),this.gridOptions.onRowUnSelected=u.getFunction(viewModel,this.gridOptions.onRowUnSelected),this.gridOptions.onBeforeAllRowSelected=u.getFunction(viewModel,this.gridOptions.onBeforeAllRowSelected),this.gridOptions.onAllRowSelected=u.getFunction(viewModel,this.gridOptions.onAllRowSelected),this.gridOptions.onBeforeAllRowUnSelected=u.getFunction(viewModel,this.gridOptions.onBeforeAllRowUnSelected),this.gridOptions.onAllRowUnSelected=u.getFunction(viewModel,this.gridOptions.onAllRowUnSelected),this.gridOptions.onBeforeRowFocus=u.getFunction(viewModel,this.gridOptions.onBeforeRowFocus),this.gridOptions.onRowFocus=u.getFunction(viewModel,this.gridOptions.onRowFocus),this.gridOptions.onBeforeRowUnFocus=u.getFunction(viewModel,this.gridOptions.onBeforeRowUnFocus),this.gridOptions.onRowUnFocus=u.getFunction(viewModel,this.gridOptions.onRowUnFocus),this.gridOptions.onDblClickFun=u.getFunction(viewModel,this.gridOptions.onDblClickFun),this.gridOptions.onValueChange=u.getFunction(viewModel,this.gridOptions.onValueChange);var columns=[];$("div",this.$element).each(function(){var ops=$(this).attr("options");if("undefined"==typeof ops)var column=eval("("+ops+")");else var column=JSON.parse(ops);var eType=u.getFunction(viewModel,column.editType),rType=u.getFunction(viewModel,column.renderType),eOptions={};if(column.editOptions)if("undefined"==typeof column.editOptions)var eOptions=eval("("+column.editOptions+")");else var eOptions=column.editOptions;eOptions.data=options.data,eOptions.field=column.field,""==eType&&(eType="string"),"string"==eType||"integer"==eType||"checkbox"==eType||"combo"==eType||"radio"==eType||"float"==eType||"currency"==eType||"datetime"==eType||"date"==eType||"time"==eType?("string"==eType?(compDiv=$('<div><input type="text" class="u-grid-edit-item-string"></div>'),options.editType&&"default"!=options.editType||compDiv.addClass("eType-input"),eOptions.dataType="string",comp=new u.OriginText({el:compDiv.find("input")[0],options:eOptions,model:viewModel})):"integer"==eType?(compDiv=$('<div><input type="text" class="u-grid-edit-item-integer"></div>'),options.editType&&"default"!=options.editType||compDiv.addClass("eType-input"),eOptions.dataType="integer",comp=new u.OriginText({el:compDiv.find("input")[0],options:eOptions,model:viewModel})):"checkbox"==eType?(compDiv=$('<div><input id="'+oThis.id+"_edit_field_"+column.field+'" type="checkbox" class="u-grid-edit-item-checkbox"></div>'),comp=new u.Checkbox({el:compDiv.find("input")[0],options:eOptions,model:viewModel})):"combo"==eType?compDiv=$('<div class="input-group  form_date u-grid-edit-item-comb"><div  type="text" class="form-control grid-combox"></div><i class="input-group-addon" ><i class="fa fa-angle-down"></i></i></div>'):"radio"==eType?options.editType&&"default"!=options.editType?(compDiv=$('<div class="u-grid-edit-item-radio"><input type="radio" name="identity" /><i data-role="name"></i></div>'),comp=new u.Radio({el:compDiv[0],options:eOptions,model:viewModel})):(compDiv=null,comp=null):"float"==eType?(compDiv=$('<div><input type="text" class="u-grid-edit-item-float"></div>'),options.editType&&"default"!=options.editType||compDiv.addClass("eType-input"),eOptions.dataType="float",comp=new u.OriginText({el:compDiv.find("input")[0],options:eOptions,model:viewModel})):"currency"==eType?(compDiv=$('<div><input type="text" class="u-grid-edit-item-currency"></div>'),options.editType&&"default"!=options.editType||compDiv.addClass("eType-input"),eOptions.dataType="currency",comp=new u.OriginText({el:compDiv.find("input")[0],options:eOptions,model:viewModel})):"datetime"==eType?(compDiv=$('<div class="input-group u-grid-edit-item-datetime" ><input class="form-control" /><div class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></div></div>'),comp=new u.DateTime({el:compDiv[0],options:eOptions,model:viewModel})):"date"==eType&&(compDiv=$('<div class="input-group u-grid-edit-item-date" ><input class="form-control" /><div class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></div></div>'),comp=new u.Date({el:compDiv[0],options:eOptions,model:viewModel})),comp&&comp.dataAdapter&&(comp=comp.dataAdapter),oThis.editComponentDiv[column.field]=compDiv,oThis.editComponent[column.field]=comp,column.editType=function(t){oThis.editComponentDiv[column.field][0].childNodes.length>0||("string"==eType?(compDiv=$('<div><input type="text" class="u-grid-edit-item-string"></div>'),options.editType&&"default"!=options.editType||compDiv.addClass("eType-input"),i=new $.compManager.plugs.string(compDiv.find("input")[0],eOptions,viewModel)):"integer"==eType?(compDiv=$('<div><input type="text" class="u-grid-edit-item-integer"></div>'),options.editType&&"default"!=options.editType||compDiv.addClass("eType-input"),i=new $.compManager.plugs.integer(compDiv.find("input")[0],eOptions,viewModel)):"checkbox"==eType?(compDiv=$('<div><input id="'+oThis.id+"_edit_field_"+column.field+'" type="checkbox" class="u-grid-edit-item-checkbox"></div>'),i=new $.compManager.plugs.check(compDiv.find("input")[0],eOptions,viewModel)):"combo"==eType?(compDiv=$('<div class="input-group  form_date u-grid-edit-item-comb"><div  type="text" class="form-control grid-combox"></div><i class="input-group-addon" ><i class="fa fa-angle-down"></i></i></div>'),i=new $.compManager.plugs.combo(compDiv[0],eOptions,viewModel)):"radio"==eType?options.editType&&"default"!=options.editType?(compDiv=$('<div class="u-grid-edit-item-radio"><input type="radio" name="identity" /><i data-role="name"></i></div>'),i=new $.compManager.plugs.radio(compDiv[0],eOptions,viewModel)):(compDiv=null,i=null):"float"==eType?(compDiv=$('<div><input type="text" class="u-grid-edit-item-float"></div>'),options.editType&&"default"!=options.editType||compDiv.addClass("eType-input"),i=new $.compManager.plugs["float"](compDiv.find("input")[0],eOptions,viewModel)):"currency"==eType?(compDiv=$('<div><input type="text" class="u-grid-edit-item-currency"></div>'),options.editType&&"default"!=options.editType||compDiv.addClass("eType-input"),i=new $.compManager.plugs.currency(compDiv.find("input")[0],eOptions,viewModel)):"datetime"==eType?(compDiv=$('<div class="input-group u-grid-edit-item-datetime" ><input class="form-control" /><div class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></div></div>'),eOptions.widgetParent=$("body"),i=new $.compManager.plugs.datetime(compDiv[0],eOptions,viewModel)):"date"==eType?(compDiv=$('<div class="input-group u-grid-edit-item-date" ><input class="form-control" /><div class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></div></div>'),eOptions.widgetParent=$("body"),i=new $.compManager.plugs.date(compDiv[0],eOptions,viewModel)):"time"==eType&&(compDiv=$('<div class="input-group u-grid-edit-item-date" ><input class="form-control" /><div class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></div></div>'),eOptions.widgetParent=$("body"),i=new $.compManager.plugs.time(compDiv[0],eOptions,viewModel)),oThis.editComponentDiv[column.field]=compDiv,oThis.editComponent[column.field]=i);var i=oThis.editComponent[column.field];if(i){t.element.innerHTML="";var e=$('<div class="u-grid-content-td-div" style="margin:0px;"></div>');oThis.getDataTableRow(t.rowObj);$(t.element).append(e),e.append(oThis.editComponentDiv[column.field]),i.required&&$(t.element).parent().find(".u-grid-edit-mustFlag").show(),
e.find(".checkbox").length>0&&(e.closest(".u-grid-edit-div").css({position:"absolute",left:"83px"}),e.closest(".u-grid-edit-whole-div").find(".u-grid-edit-label").css({"margin-left":"124px","text-align":"left"})),i.modelValueChange(t.value)}}):"function"==typeof eType&&(column.editType=eType),"booleanRender"==rType?column.renderType=function(t){var i="";"Y"==t.value&&(i="checked");var e='<input type="checkbox"   style="cursor:default;" disabled '+i+">";t.element.innerHTML=e}:"integerRender"==rType?column.renderType=function(t){t.element.innerHTML=t.value,$(t.element).css("text-align","right")}:"currencyRender"==rType?column.renderType=function(t){var i=t.gridObj,e=t.gridCompColumn,o=e.options.field,n=t.rowIndex,s=i.dataTable,d=$(i.dataSourceObj.rows[n].value).attr("$_#_@_id"),r=s.getRowByRowId(d),a=r.getMeta(o,"precision"),l=iweb.Core.getMaskerMeta("float")||{},h="number"==typeof parseFloat(a)?a:l.precision;l.precision=h,l.precision=h||l.precision;var u=new $.NumberFormater(l.precision),c=new NumberMasker(l),p=c.format(u.format(t.value)).value;t.element.innerHTML=p,$(t.element).css("text-align","right"),$(t.element).attr("title",p)}:"floatRender"==rType?column.renderType=function(t){var i=t.gridObj,e=t.gridCompColumn,o=e.options.field,n=t.rowIndex,s=i.dataTable,d=$(i.dataSourceObj.rows[n].value).attr("$_#_@_id"),r=s.getRowByRowId(d),a=r.getMeta(o,"precision"),l=iweb.Core.getMaskerMeta("float")||{},h="number"==typeof parseFloat(a)?a:l.precision;l.precision=h;var u=new $.NumberFormater(l.precision),c=new NumberMasker(l),p=c.format(u.format(t.value)).value;t.element.innerHTML=p,$(t.element).css("text-align","right"),$(t.element).attr("title",p)}:"comboRender"==rType?column.renderType=function(t){var i=u.getJSObject(viewModel,eOptions.datasource);t.element.innerHTML="",o&&(o.length=0);for(var e=t.value.split(","),o=[],n=0,s=i.length;s>n;n++)for(var d=0;d<e.length;d++)i[n].pk==e[d]&&o.push(i[n].name);var r=o.toString();t.element.innerHTML=r,$(t.element).attr("title",r)}:"dateRender"==rType?column.renderType=function(t){var i=moment(t.value).format("YYYY-M-D ");t.element.innerHTML=i,$(t.element).attr("title",i)}:"dateTimeRender"==rType?column.renderType=function(t){var i=moment(t.value).format("YYYY-M-D HH:mm");t.element.innerHTML=i,$(t.element).attr("title",i)}:"function"==typeof rType?column.renderType=rType:"radioRender"==rType&&(column.renderType=function(t){var i=u.getJSObject(viewModel,eOptions.datasource),e=t.value,o=$('<div class="u-grid-edit-item-radio"></div>');t.element.innerHTML="",$(t.element).append(o);for(var n=0;n<i.length;n++)i[n].pk==e?o.append('<input name="'+column.field+t.row.value["$_#_@_id"]+'" type="radio" value="'+i[n].pk+'" checked="true" /><i data-role="name">'+i[n].name+"</i>"):o.append('<input name="'+column.field+t.row.value["$_#_@_id"]+'" type="radio" value="'+i[n].pk+'"/><i data-role="name">'+i[n].name+"</i>");o.find(":radio").each(function(){$(this).on("click",function(){var i=this.value;o.find(":radio").each(function(){this.value==i?this.checked=!0:this.checked=!1});var e=t.gridObj,n=t.gridCompColumn,s=n.options.field,d=e.dataTable,r=t.row.value["$_#_@_id"],a=d.getRowByRowId(r);a.setValue(s,i)})})}),columns.push(column)}),app&&app.adjustFunc&&app.adjustFunc.call(app,{id:this.id,type:"gridColumn",columns:columns}),this.gridOptions.columns=columns;var onRowSelectedFun=this.gridOptions.onRowSelected;this.gridOptions.onRowSelected=function(t){var i=oThis.grid.dataSourceObj.rows[t.rowIndex].value["$_#_@_id"],e=oThis.dataTable.getIndexByRowId(i);oThis.grid.options.multiSelect?oThis.dataTable.addRowsSelect([e]):oThis.dataTable.setRowSelect(e),onRowSelectedFun&&onRowSelectedFun.call(oThis,t)},this.dataTable.on(u.DataTable.ON_ROW_SELECT,function(t){$.each(t.rowIds,function(){var t=oThis.grid.getRowIndexByValue("$_#_@_id",this),i=!0;t>-1&&(i=oThis.grid.setRowSelect(parseInt(t)),i||oThis.dataTable.setRowUnSelect(oThis.dataTable.getIndexByRowId(this)))})}),this.dataTable.on(u.DataTable.ON_ROW_ALLSELECT,function(t){oThis.grid.setAllRowSelect()}),this.dataTable.on(u.DataTable.ON_ROW_ALLUNSELECT,function(t){oThis.grid.setAllRowUnSelect()});var onRowUnSelectedFun=this.gridOptions.onRowUnSelected;this.gridOptions.onRowUnSelected=function(t){var i=oThis.grid.dataSourceObj.rows[t.rowIndex].value["$_#_@_id"],e=oThis.dataTable.getIndexByRowId(i);oThis.dataTable.setRowUnSelect(e),onRowUnSelectedFun&&onRowUnSelectedFun.call(oThis,t)},this.dataTable.on(u.DataTable.ON_ROW_UNSELECT,function(t){$.each(t.rowIds,function(){var t=oThis.grid.getRowIndexByValue("$_#_@_id",this),i=!0;t>-1&&(i=oThis.grid.setRowUnselect(parseInt(t)),i||(oThis.grid.options.multiSelect?oThis.dataTable.addRowsSelect([oThis.dataTable.getIndexByRowId(this)]):oThis.dataTable.setRowSelect(oThis.dataTable.getIndexByRowId(this))))})});var onRowFocusFun=this.gridOptions.onRowFocus;this.gridOptions.onRowFocus=function(t){var i=oThis.grid.dataSourceObj.rows[t.rowIndex].value["$_#_@_id"],e=oThis.dataTable.getIndexByRowId(i);oThis.grid.options.rowClickBan?oThis.dataTable.setRowFocus(e,!0):oThis.dataTable.setRowFocus(e),onRowFocusFun&&onRowFocusFun.call(oThis,t)},this.dataTable.on(u.DataTable.ON_ROW_FOCUS,function(t){var i=oThis.grid.getRowIndexByValue("$_#_@_id",t.rowId),e=!0;i>-1&&(e=oThis.grid.setRowFocus(parseInt(i)),e||oThis.dataTable.setRowUnFocus(oThis.dataTable.getIndexByRowId(t.rowId)))});var onRowUnFocusFun=this.gridOptions.onRowUnFocus;this.gridOptions.onRowUnFocus=function(t){var i=oThis.grid.dataSourceObj.rows[t.rowIndex].value["$_#_@_id"],e=oThis.dataTable.getIndexByRowId(i);oThis.dataTable.setRowUnFocus(e),onRowUnFocusFun&&onRowUnFocusFun.call(oThis,t)},this.dataTable.on(u.DataTable.ON_ROW_UNFOCUS,function(t){var i=oThis.grid.getRowIndexByValue("$_#_@_id",t.rowId),e=!0;i>-1&&(e=oThis.grid.setRowUnFocus(parseInt(i)),e||oThis.dataTable.setRowFocus(oThis.dataTable.getIndexByRowId(t.rowId)))}),this.dataTable.on(u.DataTable.ON_INSERT,function(t){var i=new Array;$.each(t.rows,function(){var t=this.data,e=this.rowId,o={};for(var n in t)o[n]=t[n].value;o["$_#_@_id"]=e,i.push(o)}),oThis.grid.addRows(i,t.index)}),this.dataTable.on(u.DataTable.ON_UPDATE,function(t){$.each(t.rows,function(){var t=this.data,i=this.rowId,e={};for(var o in t)e[o]=t[o].value;e["$_#_@_id"]=i;var n=oThis.grid.getRowIndexByValue("$_#_@_id",i);oThis.grid.updateRow(n,e)})}),this.dataTable.on(u.DataTable.ON_VALUE_CHANGE,function(t){var i=t.rowId,e=oThis.grid.getRowIndexByValue("$_#_@_id",i);if(-1!=e){var o=t.field,n=t.newValue;oThis.grid.updateValueAt(e,o,n)}}),this.dataTable.on(u.DataTable.ON_DELETE,function(t){var i=new Array;$.each(t.rowIds,function(){var t=oThis.grid.getRowIndexByValue("$_#_@_id",this);i.push(t)}),oThis.grid.deleteRows(i)}),this.dataTable.on(u.DataTable.ON_DELETE_ALL,function(t){oThis.grid.setDataSource({})});var onValueChangeFun=this.gridOptions.onValueChange;this.gridOptions.onValueChange=function(t){var i=oThis.getDataTableRow(oThis.grid.dataSourceObj.rows[t.rowIndex].value);i&&("object"==$.type(t.newValue)?(i.setValue(t.field,t.newValue.trueValue),i.setMeta(t.field,"display",t.newValue.showValue)):i.setValue(t.field,t.newValue)),onValueChangeFun&&onValueChangeFun.call(oThis,t)},this.dataTable.on("valueChange",function(t){var i=t.field,e=t.rowId,o=(t.oldValue,t.newValue),n=oThis.grid.getRowIndexByValue("$_#_@_id",e);n>-1&&oThis.grid.updateValueAt(n,i,o)}),this.dataTable.on(u.DataTable.ON_LOAD,function(t){if(t.length>0){var i=new Array;$.each(t,function(){var t={},e=this.data,o=this.rowId;for(var n in e){var s=e[n].value;t[n]=s}t["$_#_@_id"]=o,i.push(t)});var e={};e.values=i,oThis.grid.setDataSource(e)}}),this.dataTable.on(u.DataTable.ON_ENABLE_CHANGE,function(t){oThis.grid.setEditable(t.enable)}),this.dataTable.on(u.DataTable.ON_ROW_META_CHANGE,function(t){var i=t.field,e=t.meta,o=t.row,n=t.newValue;if("required"==e&&oThis.grid.setRequired(i,n),"precision"==e){var s=oThis.editComponent[i];s&&s.setPrecision(n);var d=oThis.grid.getRowIndexByValue("$_#_@_id",o.rowId);if(-1==d)return;var r=o.getValue(i);oThis.grid.updateValueAt(d,i,r,!0)}}),this.dataTable.on(u.DataTable.ON_META_CHANGE,function(t){var i=t.field,e=t.meta;"precision"==e&&oThis.grid.renderTypeFun({field:i})}),this.grid=$(element).grid(this.gridOptions),this.grid.dataTable=this.dataTable,this.grid.viewModel=viewModel,this.grid.gridModel=this;var data=this.dataTable.rows();if(data.length>0){var values=new Array;$.each(data,function(){var t={},i=this.data,e=this.rowId;for(var o in i){var n=i[o].value;t[o]=n}t["$_#_@_id"]=e,values.push(t)});var dataSource={};dataSource.values=values,oThis.grid.setDataSource(dataSource)}var selectIndexs=this.dataTable.getSelectedIndexs();return selectIndexs.length>0&&$.each(selectIndexs,function(){oThis.grid.setRowSelect(this)}),this};Grid.getName=function(){return"grid"},Grid.fn=Grid.prototype,Grid.fn.getDataTableRow=function(t){var i=t["$_#_@_id"],e=null,o=this.dataTable.getIndexByRowId(i);return o>-1&&(e=this.dataTable.getRow(o)),e},Grid.fn.setEnable=function(t){this.grid.setEditable(t)},Grid.fn.setShowHeader=function(t){this.grid.setShowHeader(t)},Grid.fn.editRowFun=function(t){this.dataTable.setRowSelect(t),this.grid.editRowIndexFun(t)},u.compMgr&&u.compMgr.addPlug({name:"grid",plug:Grid})}($);